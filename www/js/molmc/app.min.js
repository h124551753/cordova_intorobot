$("#title_login_i").html(_lang("g_btn_oauthLogin"));$("#header_login h1").html(_lang("g_btn_login"));$("#goToRegister").html(_lang("g_phone_register"));$("#goToForgetPwd").html(_lang("g_title_resetpwd"));$("#account_login").attr("placeholder",_lang("g_inputaccount"));$("#pwd_login").attr("placeholder",_lang("g_inputpwd"));$("#text_autologin_login").html(_lang("g_savepwdautologin"));$("#btn_login").html(_lang("g_btn_login"));$(".mid .fa-plus").html(_lang("g_newaccount"));$(".mid .fa-search").html(_lang("g_pwdrecovery"));
$("#name_register").html(_lang("g_reg_nickname"));$("#name_register").attr("placeholder",_lang("g_reg_nickname"));$("#email_register").attr("placeholder",_lang("g_reg_account_email"));$("#pwd_register").html(_lang("g_reg_pwd"));$("#pwd_register").attr("placeholder",_lang("g_reg_pwd"));$("#vldcode_register").html(_lang("g_reg_vldcode"));$("#vldcode_register").attr("placeholder",_lang("g_reg_vldcode"));$("#btn_register").html(_lang("g_btn_reg"));$("#btn_bind").html(_lang("g_btn_bind"));
$("#name_bind").attr("placeholder",_lang("g_reg_nickname"));$("#email_bind").attr("placeholder",_lang("g_reg_account"));$("#pwd_bind").attr("placeholder",_lang("g_reg_pwd"));$("#bind #usrtext_bind").html(_lang("g_bind_tips"));$("#bind label[for='newUser']").html(_lang("g_bind_newuser"));$("#bind label[for='oldUser']").html(_lang("g_bind_olduser"));$("#forgetpw h3").html(_lang("g_reg_account"));$("#account_forgetpw").attr("placeholder",_lang("g_reg_account"));$("#btn_forgetpw").html(_lang("g_btn_nextstep"));
$("#newpw_resetpw").attr("placeholder",_lang("g_inputnewpwd"));$("#repw_resetpw").attr("placeholder",_lang("g_inputpwdagain"));$("#verify").attr("placeholder",_lang("g_inputvldcode"));$("#btn_resetpw").html(_lang("g_confirmchgpwd"));$("#btn_resetpassword").html(_lang("g_confirmchgpwd"));$("#old_resetpassword").attr("placeholder",_lang("g_inputoldpwd"));$("#newpw_resetpassword").attr("placeholder",_lang("g_inputnewpwd"));$("#repw_resetpassword").attr("placeholder",_lang("g_inputpwdagain"));$("#deviceList_device span").html(_lang("g_device_empty"));
$("#step1_configdev h2").html(_lang("device_config_info1"));$("#config_dev_step1").html(_lang("device_config_info0"));$("#header_configstep1_device h1").html(_lang("device_config_title"));$("#btn_next").html(_lang("g_btn_nextstep"));$("#deviceconfig h2").html(_lang("device_config_info1"));$("#esptouch h2").html(_lang("device_config_info1"));$("#config_dev_text").html(_lang("device_config_info1"));$("#configinfo2").html(_lang("device_config_info2"));$("#configinfo3").html(_lang("device_config_info3"));
$("#configinfo4").html(_lang("device_config_info4"));$("#smartConfigInfo3").html(_lang("device_smartconfig_info"));$("#smartConfigInfo2").html(_lang("device_config_info2"));$("#smartConfiginfo4").html(_lang("device_config_info4"));$("#config_device").html(_lang("device_config_dev"));$("#config_wifi").html(_lang("device_config_wifi"));$("#config_pwd").html(_lang("device_config_pwd"));$("#btn_scane").html(_lang("device_wifi_scan"));$("#atomConfig").html(_lang("config_old"));$("#btn_devconfig").html(_lang("device_config_btn"));
$("#devconfig input").attr("placeholder",_lang("device_config_pwd"));$("#demo_device").attr("data-title",_lang("device_demo"));$("#curdev_info_device").html(_lang("device_devname"));$("#dev_city_i").html(_lang("device_city"));$("#dev_share_i").html(_lang("device_sharetype"));$("#curdev_isshared_device").html(_lang("device_sharetype_public"));$("#dev_setpublic_i").html(_lang("device_set_public"));$("#curdev_sharestatus_device").html(_lang("device_sharetype_readonly"));$("#dev_active_i").html(_lang("device_activate"));
$("#dev_desc_i").html(_lang("device_description"));$("#dev_editname_i").html(_lang("device_devname"));$("#dev_editdesc_i").html(_lang("device_description"));$("#collectdevList_device span").html(_lang("g_colldev_empty"));$("#explore_hottag_i").html(_lang("explore_poptags"));$("#explore_hottag_i1").html(_lang("explore_limitless"));$("#explore_hottag_i2").html(_lang("explore_temperature"));$("#explore_hottag_i3").html(_lang("explore_switch"));$("#input_search_explore").attr("placeholder",_lang("explore_search_placeholder"));
$("#btn_search_explore").html(_lang("explore_search"));$("#btn_mapsearch_i").html(_lang("explore_mapsearch"));$("#wifipwd_config").attr("placeholder",_lang("device_config_inputpwd"));$("#text_devices_info").html(_lang("device_info"));$("#public_name_i").html(_lang("device_devname"));$("#public_city_i").html(_lang("device_city"));$("#public_disc_i").html(_lang("device_description"));$("#public_widlist_i").html(_lang("explore_widgetslist"));$("#widgetList_explore").html(_lang("explore_nowidget"));$("#graphic .empty").html(_lang("g_graphic_empty"));
$("#graphic_noticinfo_i").html(_lang("graphic_mode_recycleDec"));$("#trigger_mode_graphic").html(_lang("graphic_mode_recycle"));$("#showtrigger_graphic h3").html(_lang("graphic_trigger"));$("#showtrigger_graphic #graphic_devname_i").html(_lang("device_devname"));$("#showtrigger_graphic #graphic_widname_i").html(_lang("device_setwidget_name"));$("#showtrigger_graphic #graphic_trigger_i").html(_lang("graphic_trigger"));$("#showaction_graphic h3").html(_lang("graphic_action"));$("#showaction_graphic #graphic_actiondevname_i").html(_lang("device_devname"));
$("#showaction_graphic #graphic_actionwidname_i").html(_lang("device_setwidget_name"));$("#showaction_graphic #graphic_actionsenname_i").html(_lang("graphic_sensors"));$("#showaction_graphic #graphic_action_i").html(_lang("graphic_action"));$("#settingtrigger_graphic h3").html(_lang("graphic_trigger"));$("#settingtrigger_graphic a").html(_lang("g_btn_nextstep"));$("#btn_next").html(_lang("g_btn_nextstep"));$("#graphic_settriggerdevname_i").html(_lang("device_devname"));$("#graphic_settriggerwidname_i").html(_lang("device_setwidget_name"));
$("#graphic_settrigger_i").html(_lang("graphic_trigger"));$("#settingaction_graphic h3").html(_lang("graphic_action"));$("#graphic_setactiondevname_i").html(_lang("device_devname"));$("#graphic_setactionwidname_i").html(_lang("device_setwidget_name"));$("#graphic_setactionsenname_i").html(_lang("graphic_sensors"));$("#graphic_setaction_i").html(_lang("graphic_action"));$("#btn_setactionconfirm").html(_lang("g_btn_nextstep"));$("#introduce_about span").html(_lang("me_aboutus"));$("#feedback_about span").html(_lang("me_feedback"));
$("#version_check_about").html(_lang("me_versioncheck"));$("#logout_about span").html(_lang("g_btn_logout"));$("#name_setting").html(_lang("me_nickname_text"));$("#account_setting").html(_lang("g_logaccount"));$("#chgpwd_i").html(_lang("g_chgpwd"));$("#about_info_i1").html(_lang("me_website"));$("#about_info_i2").html(_lang("me_wechat"));$("#about_info_i3 #about_info_i3_email").html(_lang("me_email"));$("#about_info_i4").html(_lang("me_addr"));$("#btn_submit").html(_lang("g_btn_submit"));$("#header_device h1").html(_lang("g_title_device"));
$("#header_explore h1").html(_lang("g_title_explore"));$("#header_graphic h1").html(_lang("g_title_graphic"));$("#header_about h1").html(_lang("g_title_account"));$("#save_recipe").html(_lang("g_btn_save"));$("#header_edit_graphic h1").html(_lang("g_title_creatrecipe"));$("#header_showgraphic h1").html(_lang("g_title_controld"));$("#header_register h1").html(_lang("g_btn_reg"));$("#header_register .headerright").html(_lang("g_title_userprot"));$("#header_user_protocol h1").html(_lang("g_title_userprot"));
$("#header_forgetpw h1").html(_lang("g_title_resetpwd"));$("#header_setting h1").html(_lang("g_title_setting"));$("#header_devinfo_device h1").html(_lang("device_info"));$("#header_editdevinfo_device h1").html(_lang("device_modifyinfo"));$("#header_editdevinfo_device .headerright").html(_lang("g_btn_save"));$("#header_collectdev_device h1").html(_lang("device_favourite"));$("#header_feedback h1").html(_lang("me_feedback"));$("#header_aboutus h1").html(_lang("me_aboutus"));$("#navbar_device").html(_lang("g_tab_device"));
$("#navbar_explore").html(_lang("g_tab_explore"));$("#navbar_graphic").html(_lang("g_tab_graphic"));$("#navbar_about").html(_lang("g_tab_account"));$("#login").attr("data-title",_lang("g_btn_login"));$("#register").attr("data-title",_lang("g_btn_reg"));$("#header_register .headerright").attr("href",_lang("protocol_panelid"));$("#user_protocol").attr("data-title",_lang("g_title_userprot"));$("#forgetpw").attr("data-title",_lang("g_title_resetpwd"));$("#resetpw").attr("data-title",_lang("g_title_resetpwd"));
$("#setting").attr("data-title",_lang("g_title_setting"));$("#about").attr("data-title",_lang("g_tab_account"));$("#about_us").attr("data-title",_lang("me_aboutus"));$("#feedback").attr("data-title",_lang("me_feedback"));$("#name_setting_i").html(_lang("me_nickname_text"));$("#account_setting_i").html(_lang("g_logaccount"));$("#isremember").attr("data-on",_lang("g_btn_yes"));$("#isremember").attr("data-off",_lang("g_btn_no"));$("#isshared").attr("data-on",_lang("g_on"));
$("#isshared").attr("data-off",_lang("g_off"));$("#setshare").attr("data-on",_lang("g_on"));$("#setshare").attr("data-off",_lang("g_off"));$("#switch_graphic").attr("data-on",_lang("graphic_toggle_cycle"));$("#switch_graphic").attr("data-off",_lang("graphic_toggle_edge"));$("#trigger_graphic").attr("data-on",_lang("g_on"));$("#trigger_graphic").attr("data-off",_lang("g_off"));$("#action_graphic").attr("data-on",_lang("g_on"));$("#action_graphic").attr("data-off",_lang("g_off"));
$("#curtainstatus").attr("data-on",_lang("g_on"));$("#curtainstatus").attr("data-off",_lang("g_off"));
(function(a){var b=function(){},f=function(b,d,e,k,l){void 0===l&&(l=!0);e&&(e=JSON.stringify(e));a.molmc.utils.checkNetwork()&&(a.molmc.alwaysHideMask||a.ui.showMask(_lang("device_loading")),a.ajax({type:b,url:d,data:e,dataType:"json",timeout:5E3,contentType:"application/json",headers:{"X-OS":a.molmc.utils.getDeviceSystem(),"X-App-Version":a.molmc.utils.appVersion,"X-Device-Modle":a.molmc.utils.getDeviceType()},success:function(b){a.ui.hideMask();a.isFunction(k)&&k(b)},error:function(b,c){a.ui.hideMask();
var e=JSON.parse(b.response);a.molmc.httpStatus.responseErr(e.code)},async:l}))};b.prototype={login:function(b,d){f("POST",serverURL+"/v1/users?act=login",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c,1)})},authSearch:function(b,d,e){f("POST",serverURL+"/v1/users?act=search",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):c.toString().startsWith("605")?a.isFunction(e)&&e(b.data):a.molmc.httpStatus.responseErr(c,
1)})},authBind:function(b,d,e){f("POST",serverURL+"/v1/users?act=bind",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):void 0!==e&&(c.toString().startsWith("606")||c.toString().startsWith("605"))?e(c):a.molmc.httpStatus.responseErr(c,1)})},getAuthState:function(b){f("GET",serverURL+"/v1/users?act=stateCodePrdc",null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)})},authCodeToAccessToken:function(b,
d,e,k){f("GET",serverURL+"/v1/users?act=oauth&client=wechat_mobile&code="+b+"&state="+d,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(e)&&e(b.data):c.toString().startsWith("605")?a.isFunction(k)&&k(b.data):a.molmc.httpStatus.responseErr(c)})},getQQAuthInfo:function(b,d,e,k){f("GET","https://graph.qq.com/user/get_user_info?oauth_consumer_key="+b+"&access_token="+d+"&openid="+e,null,function(b){void 0!==b?a.isFunction(k)&&k(b):a.molmc.httpStatus.responseErr(code)})},register:function(b,
d){f("POST",serverURL+"/v1/users?act=register",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):(a.molmc.httpStatus.responseErr(c,2),a.molmc.app.ChangevldCode())})},forgetpw:function(b,d){f("POST",serverURL+"/v1/users?act=forgetpw",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},resetpw:function(b,d){f("POST",serverURL+"/v1/users?act=resetpw",b,function(b){var c=b.code;c.toString().startsWith("20")?
a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c,4)})},newPwd:function(b,d){f("POST",serverURL+"/v1/users?act=newpw",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c,4)})},getPhoneVldCode:function(b,d,e,k){f("GET",serverURL+"/v1/users?act=vldCodePrdc&type=sms&phone="+b+"&zone="+d+"&method="+e,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(k)&&k(b.data.roundtime):a.molmc.httpStatus.responseErr(c)})},
checkVerifyCode:function(b,d){f("GET",serverURL+"/v1/users?act=vldCodeVrfy&vldCode="+b,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c,5)})},feedback:function(b,d){f("POST",serverURL+"/v1/users?act=feedback&type=device",d,function(d){var k=d.code;k.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(k)})},checkVersion:function(b){if("android"===device.platform.toLowerCase()){var d=serverURL+"/v1/resources?act=getInfo&type="+
device.platform.toLowerCase();f("GET",d,null,function(d){var k=d.code;k.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(k)})}},logout:function(b){f("GET",serverURL+"/v1/users?act=logout",null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)})},createDevice:function(b,d,e){f("POST",serverURL+"/v1/devices",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):void 0!==
e&&401!==c?e(c):a.molmc.httpStatus.responseErr(c)})},getDevices:function(b){f("GET",serverURL+"/v1/devices",null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e,3)})},getDeviceInfo:function(b,d){f("GET",serverURL+"/v1/devices/"+b,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},updateDeviceInfo:function(b,d,e){f("PUT",serverURL+"/v1/devices/"+b,d,function(b){var c=
b.code;c.toString().startsWith("20")?a.isFunction(e)&&e(b.data):a.molmc.httpStatus.responseErr(c)})},getDemoDevList:function(b){f("GET",serverURL+"/v1/devices?act=search&type=demo",null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)})},repaintDemoDev:function(b,d,e){f("GET",serverURL+"/v1/devices/"+b+"?act=repaint&ref_id="+d,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(e)&&e(b.data):a.molmc.httpStatus.responseErr(c)})},
forkDemoApp:function(b,d){f("GET",serverURL+"/v1/demos/"+b+"?act=fork",null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},compileApp:function(b,d){f("POST",serverURL+"/v1/bins?type=app&act=flash&id="+b,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},searchHotDevices:function(b){f("GET",serverURL+"/v1/devices?act=search&type=hotspot",null,function(d){var e=
d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)})},searchCollectDevices:function(b){f("GET",serverURL+"/v1/favorites",null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)},!1)},deleteCollectDevice:function(b,d){f("DELETE",serverURL+"/v1/favorites/"+b,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},deleteDevice:function(b,
d){f("DELETE",serverURL+"/v1/devices/"+b,null,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},searchPubDevices:function(b,d,e,k){void 0===e&&(e=1);void 0===k&&(k=20);void 0===d?e=serverURL+"/v1/devices?act=search&type=public&page=1":(d=encodeURI(d),e=serverURL+"/v1/devices?act=search&type=public&page="+e+"&size="+k,""!==d&&(e+="&"+d));f("GET",e,null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):
a.molmc.httpStatus.responseErr(e)})},getPubDevice:function(b,d,e){f("GET",serverURL+"/v1/devices?act=search&type=public&device_id="+d,null,function(d){d.code.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.isFunction(e)&&e()})},collectDevice:function(b,d){f("POST",serverURL+"/v1/favorites",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},getTokens:function(b){f("GET",serverURL+"/v1/tokens",null,function(d){var e=d.code;
e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)},!1)},getDeviceToken:function(b,d){f("GET",serverURL+"/v1/tokens?device_id="+d,null,function(d){var k=d.code;k.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(k)})},getPubDevToken:function(b,d){f("GET",serverURL+"/v1/tokens?act=search&type=public&device_id="+d,null,function(d){var k=d.code;k.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(k,
7)},!1)},createDevToken:function(b,d){f("POST",serverURL+"/v1/tokens?type=public",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},updateDevToken:function(b,d){f("PUT",serverURL+"/v1/tokens/"+b._id+"?type=public",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},deleteDevToken:function(b,d){f("DELETE",serverURL+"/v1/tokens/"+b+"?type=public",payload,function(b){var c=
b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},getRecipes:function(b){f("GET",serverURL+"/v1/recipes",null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)})},getSchedules:function(b){f("GET",serverURL+"/v1/schedules",null,function(d){var e=d.code;e.toString().startsWith("20")?a.isFunction(b)&&b(d.data):a.molmc.httpStatus.responseErr(e)})},createRecipe:function(b,d){f("POST",serverURL+
"/v1/recipes",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},createSchedule:function(b,d){f("POST",serverURL+"/v1/schedules",b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},updateRecipe:function(b,d){f("PUT",serverURL+"/v1/recipes/"+b._id,b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},
updateSchedule:function(b,d){f("PUT",serverURL+"/v1/schedules/"+b._id,b,function(b){var c=b.code;c.toString().startsWith("20")?a.isFunction(d)&&d(b.data):a.molmc.httpStatus.responseErr(c)})},deleteRecipe:function(b,d){f("DELETE",serverURL+"/v1/recipes/"+b,null,function(b){b=b.code;b.toString().startsWith("20")?a.isFunction(d)&&d():a.molmc.httpStatus.responseErr(b)})},deleteSchedule:function(b,d){f("DELETE",serverURL+"/v1/schedules/"+b,null,function(b){b=b.code;b.toString().startsWith("20")?a.isFunction(d)&&
d():a.molmc.httpStatus.responseErr(b)})},initMap:function(){a.molmc.position={localCountry:"China",city:"\u5317\u4eac\u5e02",lat:39.90923,lng:116.397428};f("GET",serverURL+"/v1/resources?act=geoip",null,function(b){a.molmc.position={};200==b.code?a.molmc.position={localCountry:b.data.country||"China",city:b.data.city||"\u5317\u4eac\u5e02",lat:parseFloat(b.data.latitude)||39.90923,lng:parseFloat(b.data.longitude)||116.397428}:(a.molmc.localCountry="",a.molmc.position={localCountry:"China",city:"\u5317\u4eac\u5e02",
lat:39.90923,lng:116.397428});"china"==a.molmc.position.localCountry.toLowerCase()&&require(["http://webapi.amap.com/maps?v=1.3&key=e79fe1ecb0923cd5e4a4945955a4536e"],function(){})})}};a.molmc.api=new b})(af);
(function(a){a.molmc.mqtt=function(b){var f=serverMQTT,c=this;this.outbox=[];this.subscriptions=[];this.messages=[];this.connected=0;this.password=this.username="";this.reConnectCount=0;this.reConnectTimer;this.initialize=function(a){_.isObject(a)||(a={});_.isEmpty(a.userID)||(c.userID=a.userID,delete a.userID);for(var b=(new Date).getTime(),k="",l=0;13>l;l++)k+="0123456789qwertyuioplkjhgfdsazxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM".charAt(Math.ceil(1E8*Math.random())%62);clientId=b.toString().substr(-10,
10)+k;c.ws=new Paho.MQTT.Client(f,11883,clientId);c.defaultTopicList=[{topic:"v1/service/platform/default/info/time"}];_.isEmpty(c.userID)||c.defaultTopicList.push({topic:"v1/"+c.userID+"/channel/userDevice/cmd/updata"});c.openConnect(a)};this.onConnect=function(){c.connected=2;var a=c.subscriptions;c.subscriptions=_.filter(c.subscriptions,function(a){return 1===a.status});a.forEach(function(a){0===a.status&&c.subscribe(a.topic,a.qos,null,a.subSucCallback)});c.defaultTopicList.forEach(function(a){c.subscribe(a.topic,
2)});c.outbox.forEach(function(a){c.publish(a.topic,a.payload,a.qos,a.retain)});c.outbox=[]};this.onMessageArrived=function(a){c.trigger("mqtt:"+a.destinationName,a)};this.onConnectionLostAccident=function(a){c.connected=-1;c.messages=[];c.openConnect({userName:c.username,password:c.password});if(0!==a.errorCode)throw Error("debug: "+a.errorMessage);};this.onFailure=function(a){c.connected=-1;c.reConnectTimer&&clearTimeout(c.reConnectTimer);var b=c.reConnectCount*c.reConnectCount*50;5E3>b&&c.reConnectCount++;
c.reConnectTimer=setTimeout(function(){c.openConnect({userName:c.username,password:c.password},!0)},b);throw Error("error: "+a.errorMessage);};this.openConnect=function(b,e){_.isObject(b)||(b={});_.isEmpty(b.userID)||(c.userID=b.userID,delete b.userID);if(!_.isEmpty(b.userName)){!0!==e&&(c.reConnectCount=0,c.reConnectTimer&&clearTimeout(c.reConnectTimer));var k={timeout:10,userName:"",password:a.molmc.utils.getItem("account"),keepAliveInterval:50,cleanSession:!0,useSSL:!1,onSuccess:c.onConnect,onFailure:c.onFailure},
f=a.extend(k,b);if(0===c.connected)c.ws.connect(f),c.connected=1,c.username=f.userName,c.password=f.password;else if(-1===c.connected)f.onSuccess=function(){var a=c.subscriptions;c.subscriptions=[];a.forEach(function(a){c.connected=2;c.subscribe(a.topic,a.qos)})},c.ws.connect(f),c.connected=1,c.username=f.userName,c.password=f.password;else{2===c.connected&&c.username!==f.userName&&c.disconnect(function(){c.ws.connect(f);c.connected=1;c.username=f.userName;c.password=f.password;c.ws.onConnectionLost=
c.onConnectionLostAccident});return}c.ws.onConnectionLost=c.onConnectionLostAccident;c.ws.onMessageArrived=c.onMessageArrived}};this.disconnect=function(a){void 0!==c.ws&&null!==c&&(c.subscriptions.forEach(function(a){c.off("mqtt:"+a.topic)}),_.isFunction(a)?c.ws.onConnectionLost=a:c.ws.onConnectionLost=function(){c.connected=0},1!==c.connected&&2!==c.connected||c.ws.disconnect(),c.reConnectTimer&&clearTimeout(c.reConnectTimer),c.connected=0,c.subscriptions=[],c.messages=[])};this.publish=function(a,
b,f,l){var n=new Paho.MQTT.Message(b);n.destinationName=a;n.qos=f;n.retained=l;if(2!==c.connected){if(_.findWhere(c.outbox,{topic:a}))return!1;c.outbox.push({topic:a,payload:b,qos:f,retain:l})}else c.ws.send(n);return!0};this.subscribe=function(a,b,f,l){if(1>a.length)return!1;if(_.findWhere(c.subscriptions,{topic:a}))return!0;_.isFunction(f)&&(c.off("mqtt:"+a),c.on("mqtt:"+a,f));c.subscriptions.push({topic:a,qos:b,status:0,subSucCallback:l});2===c.connected&&c.ws.subscribe(a,{qos:b,onSuccess:function(){var b=
_.findWhere(c.subscriptions,{topic:a});_.isObject(b)&&(b.status=1,b.subSucCallback=null);_.isFunction(l)&&l()}});return!0};this.unsubscribe=function(a,b){if(!_.findWhere(c.subscriptions,{topic:a}))return b&&b(),!1;2!==c.connected?c.off("mqtt:"+a):c.ws.unsubscribe(a,{onSuccess:function(){c.subscriptions=_.filter(c.subscriptions,function(b){return b.topic!=a});c.off("mqtt:"+a);b&&b()}});return!0};this.unsubscribeAll=function(){_.each(c.subscriptions,function(a){_.findWhere(c.defaultTopicList,{topic:a.topic})||
(c.off("mqtt:"+a.topic),2===c.connected&&c.ws.unsubscribe(a.topic,{onSuccess:function(){}}),c.subscriptions=_.filter(c.subscriptions,function(b){return b.topic!=a.topic}))})};this.on=a.molmc.Events.on;this.off=a.molmc.Events.off;this.trigger=a.molmc.Events.trigger;this.initialize.apply(this,arguments)}})(af);
(function(a){var b={},f,c,d,e,k=function(){},l=function(a,b,c,g){window.resolveLocalFileSystemURL(a,function(a){a.getFile(b,{create:!1},c,function(a){_.isFunction(g)?g(a):navigator.notification.confirm(_lang("g_file_notfound"),null,_lang("g_tips_error"),_lang("g_tips_confirm"))})},m)},n=function(a,b,c){window.resolveLocalFileSystemURL(a,function(a){a.removeRecursively(b,m)},function(a){c()})},t=function(a){window.resolveLocalFileSystemURL(a,function(a){a.remove(function(a){},m)},m)},p=function(a){new FileTransfer;
A(serverURL+"/downloads/package/widgets/widgetslist.json",fileSystemRoot+"cache/widgetslist.json",a)},w=function(a){new FileTransfer;var b=serverURL+"/downloads/package/widgets/lang_ser.js";console.log(b);A(b,c,a)},z=function(a){new FileTransfer;var b=serverURL+"/downloads/package/widgets/action.js";console.log(b);A(b,d,a)},x=function(a){new FileTransfer;var b=serverURL+"/downloads/package/widgets/trigger.js";console.log(b);A(b,e,a)},A=function(a,b,c){(new FileTransfer).download(a,b,function(a){_.isFunction(c)&&
c(a)},function(a){},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}})},y=function(a,b){a.file(function(a){var g=new FileReader;g.onload=b;g.onerror=m;g.readAsText(a)},h)},B=function(v){void 0!=v&&0<v.length&&(w(function(){require([c],function(b){a.molmc.Lang=b})}),z(function(){require([d],function(b){a.molmc.actionEvent=b})}),x(function(){require([e],function(b){a.molmc.triggerEvent=b})}));for(var C=0;C<v.length;C++)C===v.length-1?E(v[C],function(){window.resolveLocalFileSystemURL(fileSystemWidget+
"widgetslist.json",function(a){a.createWriter(function(a){a.onwrite=function(a){};a.error=h;a.write(JSON.stringify(b))},m)},m)}):E(v[C])},E=function(a,b){(new FileTransfer).download(serverURL+"/downloads/package/widgets/"+a+".zip",fileSystemRoot+"cache/"+a+".zip",function(c){var g=function(){F(c.nativeURL,b)};n(fileSystemWidget+a,g,g)},function(a){},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}})},F=function(a,b){zip.unzip(a,fileSystemWidget,function(a){0==a&&_.isFunction(b)&&
b(a)},function(a){})},m=function(a){},h=function(a){};k.prototype={initPath:function(){f=fileSystemRoot;c=f+"lang_ser.js";d=f+"action.js";e=f+"trigger.js"},checkWidgetsUpdate:function(){p(function(a){y(a,function(a){l(fileSystemWidget,"widgetslist.json",function(c){y(c,function(g){g=JSON.parse(g.target.result.toString());var c=JSON.parse(a.target.result.toString()),v=[];b=c;for(var G=!1,d=0;d<c.list.length;d++){for(var G=!1,u=0;u<g.list.length;u++)if(g.list[u].widget_id===c.list[d].widget_id){G=!0;
g.list[u].ver!==c.list[d].ver&&v.push(c.list[d].widget_id);break}!1===G&&v.push(c.list[d].widget_id)}B(v)})})})})},unzipWidgetsToData:function(b){var c=this;window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(d){zip.unzip(b,cordova.file.dataDirectory,function(g){0==g&&(t(b),a.molmc.utils.checkWifi(!0)&&c.checkWidgetsUpdate())},function(a){})},m)},copyWidgetsZipToData:function(b,c){var d=this;window.resolveLocalFileSystemURL(fileSystemWidget,function(){a.molmc.utils.checkWifi(!0)&&d.checkWidgetsUpdate()},
function(){window.resolveLocalFileSystemURL(b,function(a){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(b){b.root.getFile("widgets.zip",{create:!1},function(d){d.remove(function(){a.copyTo(b.root,"widgets.zip",c,m)},m)},function(){a.copyTo(b.root,"widgets.zip",c,m)})},m)},m)})},langActionTrigger:function(){l(f,"lang_ser.js",function(){require([c],function(b){a.molmc.Lang=b})},function(a){});l(f,"action.js",function(){require([d],function(b){a.molmc.actionEvent=b})},function(){require(["action"],
function(b){a.molmc.actionEvent=b})});l(f,"trigger.js",function(){require([e],function(b){a.molmc.triggerEvent=b})},function(){require(["trigger"],function(b){a.molmc.triggerEvent=b})})}};a.molmc.update=new k})(af);
(function(a){var b,f=function(){function v(a){}function C(a){}function u(a){alert(a.type+" - "+a.message)}function g(a){h.removeEventListener("loadstart",v);h.removeEventListener("loadstop",C);h.removeEventListener("loaderror",u);h.removeEventListener("exit",g)}var q=this;window.addEventListener("load",function(){a.molmc.goShowWidget=!1;a.molmc.alwaysHideMask=!1;a.molmc.utils.setItem("firstConfig",!0)},!1);a.ui.ready(function(){});var h=null;"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=
function(a){return this.slice(0,a.length)==a});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a});window.document.addEventListener("touchmove",function(a){window.scroll(0,0);return!1},!1);a.os.ios&&a("#about #versioncheck_about").hide();document.addEventListener("deviceready",function(){window.Cordova&&navigator.splashscreen&&(a.os.ios?(fileSystemRoot=cordova.file.dataDirectory,fileSystemWidget=fileSystemRoot+"widgets/"):a.os.android&&
(fileSystemRoot=cordova.file.applicationStorageDirectory+"files/",fileSystemWidget=fileSystemRoot+"widgets/"),cordova.getAppVersion.getVersionNumber(function(b){a.molmc.utils.appVersion=b}),a("#goToRegister").bind("tap",function(){a.ui.loadContent("#register_phone",!1,!1,"slide")}),a("#register").bind("loadpanel",function(){a("#name_register").val("");a("#email_register").val("");a("#pwd_register").val("");a("#vldcode_register").val("");a("#defaultHeader .backButton").show();a("#header_register h1").html(_lang("g_btn_reg"));
l(a("#vld_register"))}),a("#goToEmailRegister").bind("tap",function(){a.ui.loadContent("#register",!1,!0,"pop")}),a("#forgetpw").bind("loadpanel",function(){a("#account_forgetpw").val("");a("#verify").val("");a("#newpw_resetpw").val("");a("#repw_resetpw").val("")}),a("#register_phone").bind("loadpanel",function(){a("#register_phone #regetVld").attr("data-on","1");a("#name_regphone").val("");a("#phone_regphone").val("");a("#pwd_regphone").val("");a("#phone_zone").bind("tap",function(){k()});a("#register_phone #count_txt").html("\u70b9\u51fb\u83b7\u53d6\u9a8c\u8bc1\u7801");
a("#register_phone #sec_count").html("");a("#defaultHeader .backButton").show();a("#header_register h1").html(_lang("g_phone_register"));a("#header_register .headerright").show()}),a("#goToPhoneRegister").bind("tap",function(){a.ui.loadContent("#register_phone",!1,!0,"pop")}),a("#vld_register_phone").bind("loadpanel",function(){a("#vld_register_phone #regetVld").attr("data-on","1");a("#defaultHeader .backButton").show();a("#header_register h1").html(_lang("g_phone_register"));a("#header_register .headerright").hide();
var b=a("#phone_regphone").val();a("#vld_register_phone #targetPhone").html(b);t(90,"#vld_register_phone")}),a("#register_phone").bind("unloadpanel",function(){clearInterval(b);a("#vldcodephone_regphone").val("")}),a("#resetpwd2").bind("loadpanel",function(){a("#resetpwd2 #regetVld").attr("data-on","1");a("#defaultHeader .backButton").show();a("#header_register h1").html(_lang("g_phone_register"));a("#header_register .headerright").hide();var b=a("#account_forgetpw").val();a("#resetpwd2 #targetPhone").html(b);
a("#resetpwd2 #count_txt").html("\u70b9\u51fb\u83b7\u53d6\u9a8c\u8bc1\u7801");a("#resetpwd2 #sec_count").html("");a("#resetpwd2 #txtsent").css("display","none");a("#resetpwd2 #targetPhone").css("display","none")}),a("#resetpwd2").bind("unloadpanel",function(){clearInterval(b);a("#resetpwd2 #targetPhone").val("")}),a("#btn_login").bind("tap",function(){q.Login()}),a("#btn_register").bind("tap",function(){var b=a("#name_register").val(),c=a("#email_register").val(),g=a("#pwd_register").val(),r=a("#vldcode_register").val();
q.Register(b,c,g,r,"email")}),a("#btn_getVldPhone").bind("tap",function(){var b=a("#phone_regphone").val(),c=a("#name_regphone").val(),g=a("#pwd_regphone").val(),r=a("#phone_zone").val();n(c,b,r,g)}),a("#register_phone #regetVld").bind("tap",function(){var b=a("#phone_regphone").val(),c=a("#phone_zone").val(),c=c.replace(/\+/,"00"),g=function(){t(90,"#register_phone")};a.molmc.utils.checkPhone(b)?"1"==a("#register_phone #regetVld").attr("data-on")&&a.molmc.api.getPhoneVldCode(b,c,"register",g):navigator.notification.confirm(_lang("g_error_phoneformat"),
function(){},_lang("g_tips_error"),_lang("g_tips_confirm"))}),a("#vld_register_phone #regetVld").bind("tap",function(){var b=a.molmc.utils.getItem("phoneNum"),c=a.molmc.utils.getItem("phoneZone"),g=function(){t(90,"#vld_register_phone")};"1"==a("#vld_register_phone #regetVld").attr("data-on")&&a.molmc.api.getPhoneVldCode(b,c,"register",g)}),a("#resetpwd2 #regetVld").bind("tap",function(){var b=a("#account_forgetpw").val(),c=function(b){a("#resetpwd2 #txtsent").css("display","block");a("#resetpwd2 #targetPhone").css("display",
"block");t(b,"#resetpwd2")};"1"==a("#resetpwd2 #regetVld").attr("data-on")&&a.molmc.api.getPhoneVldCode(b,"","forgetpw",c)}),a("#btn_forgetpw").bind("tap",function(){q.Forgetpw()}),a("#btn_resetpw").bind("tap",function(){var b=a("#verify").val(),c=a("#newpw_resetpw").val(),g=a("#repw_resetpw").val();q.Resetpw(b,c,g)}),a("#btn_resetpw2").bind("tap",function(){var b=a("#resetpwd2 #vldcodephone_regphone").val(),c=a("#resetpwd2 #pwd_regphone").val(),g=a("#resetpwd2 #pwd_regphone").val();q.Resetpw(b,c,
g)}),a("#vld_register").bind("tap",function(){l(a("#vld_register"))}),a("#vld_regphone").bind("tap",function(){l(a("#vld_regphone"))}),a("#btn_regphone").bind("tap",function(){var b=a("#phone_regphone").val(),c=a("#name_regphone").val(),g=a("#pwd_regphone").val(),r=a("#vldcodephone_regphone").val(),d=a("#phone_zone").val();q.Register(c,b,g,r,"phone",d)}),a("#toggle_login").bind("change",function(){1==a("#toggle_login").val()?a("#toggle_login").val(0):a("#toggle_login").val(1)}),p(a("#device"),"device"),
p(a("#graphic"),"graphic"),a.molmc.explore.pullUprefreshPage(a("#explore")),a("#logout_about").bind("tap",function(){if(a.os.ios){var b=[_lang("g_btn_cancel"),_lang("g_btn_confirm")];navigator.notification.confirm("",function(b){2===b&&(a(document).trigger("applogout"),a.molmc.app.Logout(),a.ui.loadContent("#login",!1,!1,"slide"))},_lang("ios_me_exit"),b)}else if(a.os.android){var b='<ul class="list" style="font-size:1.3em;"><li id="exitlogin"><i class="fa fa-user"> '+_lang("me_logout")+'</i></li><li id="exitapp" style="marging-top:10px;"><i class="fa fa-power-off"> '+
_lang("me_exit")+"</i></li></ul>",c=a.ui.popup({id:"popup_exit",title:"Alert! Alert!",message:b,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm done!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!0,posOffset:50});a("#popup_exit #exitlogin").bind("tap",function(){a(document).trigger("applogout");c.hide();q.Logout();a.ui.loadContent("#login",!1,!1,"slide")});a("#popup_exit #exitapp").bind("tap",function(){c.hide();q.Logout();setTimeout(function(){a.molmc.utils.exitApp()},
500)})}}),a("#btn_submit").bind("tap",function(){q.Feedback()}),a("#btn_resetpassword").bind("tap",function(){z()}),a("#about").bind("loadpanel",function(){a.molmc.device.isUtopicInDevPanel("none");a("#account_about").html(d());a("#defaultHeader .backButton").hide();var b=a.molmc.utils.getItem(a.molmc.utils.getItem("uid"));null!==b?a("#headimg").attr("src",b):a("#headimg").attr("src","./img/user_placeholder.png")}),a("#bind").bind("loadpanel",function(){a("#header_register h1").html(_lang("g_btn_bind"));
var b=a.molmc.utils.getItem("headUrl");null!==b&&a("#auth_head").attr("src",b)}),a("#bind").on("tap","#btn_bind",function(){m()}),a("#setting").bind("loadpanel",function(){a("#old_resetpassword").val("");a("#newpw_resetpassword").val("");a("#repw_resetpassword").val("");a("#defaultHeader .backButton").show();a("#name_setting").html(a.molmc.utils.getItem("username"));a("#account_setting").html(d())}),a("#about_us").bind("loadpanel",function(){a("#defaultHeader .backButton").show();a("#about_us #appversion_about").html(_lang("me_version")+
a.molmc.utils.appVersion)}),a("#feedback").bind("loadpanel",function(){a("#defaultHeader .backButton").show();var b=_lang("me_feedbackprompt");a("textarea").val(b);a("textarea").addClass("fonthintcolor");a("textarea").focus(function(){a(this).val()==b&&(a(this).val(""),a(this).removeClass("fonthintcolor"))});a("textarea").blur(function(){""===a(this).val()&&(a(this).val(b),a(this).addClass("fonthintcolor"))})}),a("#about").on("tap","#versioncheck_about",function(){x();a.os.ios?a("#about #versioncheck_about").hide():
c(a.molmc.utils.getItem("appVerInServer"),a.molmc.utils.appVersion)?navigator.notification.confirm(_lang("me_updateinfo")+"\n"+_lang("app_update_changes"),function(a){1===a&&A()},_lang("me_updateprom"),_lang("g_btn_yes")+","+_lang("g_btn_no")):navigator.notification.alert(_lang("tips_app_latest"),"",_lang("tips_title_tips"),_lang("g_tips_confirm"))}),a("#about_us").on("tap","#offical_website",function(){a.os.ios&&(h=window.open("http://www.intorobot.com","_blank","location=yes,toolbarposition=top,closebuttoncaption=\u5173\u95ed,enableViewportScale=yes"),
h.addEventListener("loadstart",v),h.addEventListener("loadstop",C),h.addEventListener("loaderror",u),h.addEventListener("exit",g))}),a(".headerleft").bind("tap",function(){a.ui.goBack()}),a.os.ios&&(window.open=cordova.InAppBrowser.open,e()),a("#wechat_login").bind("tap",function(){y()}),a("#qq_login").bind("tap",function(){E()}),a.os.android&&setTimeout(function(){w()},3E3),navigator.splashscreen.hide(),a.molmc.update.initPath(),a.molmc.update.copyWidgetsZipToData(cordova.file.applicationDirectory+
"www/js/molmc/widgets.zip",function(b){a.molmc.update.unzipWidgetsToData(b.nativeURL)}),a.molmc.update.langActionTrigger(),a.molmc.api.initMap())},!1)},c=function(a,b){for(var c=[],g=[],c=a.split("."),g=b.split("."),d=0;d<c.length;d++)if(parseInt(c[d])>parseInt(g[d]))return!0;return!1},d=function(){return a.molmc.utils.getItem("account")},e=function(){a("#login").bind("loadpanel",function(){a.ui.clearHistory();"true"==a.molmc.utils.getItem("autoLogin")?(a("#toggle_login").attr("checked","checked"),
a("#toggle_login").prop("checked",!0),a("#toggle_login").val(1)):(a("#toggle_login").removeAttr("checked"),a("#toggle_login").prop("checked",!1),a("#toggle_login").val(0));a("#account_login").val(d())});"true"==a.molmc.utils.getItem("autoLogin")?(a("#toggle_login").attr("checked","checked"),a("#toggle_login").prop("checked",!0),a("#toggle_login").val(1),a.ui.loadContent("#device",!1,!1,"slide")):(a("#toggle_login").removeAttr("checked"),a("#toggle_login").prop("checked",!1),a("#toggle_login").val(0));
a("#account_login").val(d());a.molmc.utils.setItem("loginType","intorobot")},k=function(){for(var b="",c=a.molmc.countryCode.getCode(),d=0;d<c.length;d++)b=b+'<li data-name="'+c[d].code+'">'+c[d].name+" (+"+c[d].code+")</li>";var b='<ul class="list" style="overflow:auto;max-height:300px">'+b+"</ul>",g=a.ui.popup({id:"popup_codeList",title:_lang("select_countrycode"),message:b,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm done!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,
tapHide:!0,suppressTitle:!1,posOffset:50});setTimeout(function(){a("#popup_codeList").on("tap","li",function(b){g.hide();b=b.currentTarget.attributes[0].value;a("#phone_zone").val("+"+b)})},500)},l=function(b){var c=serverURL+"/v1/users?act=vldCodePrdc&type=image&_t="+a.molmc.utils.getTimestamp();b.attr("src",c)},n=function(b,c,d,g){if(0===b.length||0===c.length||0===g.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),
!1;if(6>g.length)return navigator.notification.confirm(_lang("g_error_pwdatleast6"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(2>a.molmc.utils.checkPassword(g))return navigator.notification.confirm(_lang("g_error_pwdatleast2mode"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(!a.molmc.utils.checkPhone(c))return navigator.notification.confirm(_lang("g_error_phoneformat"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;d=d.replace(/\+/,"00");
a.molmc.utils.setItem("phoneZone",d);a.molmc.api.getPhoneVldCode(c,d,"register",function(){a.molmc.utils.setItem("phoneNum",c);a.ui.loadContent("#vld_register_phone",!1,!1,"slide")})},t=function(c,d){void 0===c&&(c=90);clearInterval(b);var h=d+" #sec_count",g=d+" #count_txt",q=d+" #regetVld";a(h).html(c);a(g).html("\u79d2\u540e\u91cd\u65b0\u83b7\u53d6");a(q).attr("data-on","0");b=setInterval(function(){c--;a(h).html(c);0>=c&&(c=0,a(q).attr("data-on","1"),a(h).html(""),a(g).html("\u70b9\u51fb\u91cd\u65b0\u83b7\u53d6"),
clearInterval(b))},1E3)},p=function(b,c){var d;d=b.scroller({verticalScroll:!0,horizontalScroll:!1,autoEnable:!0});d.addPullToRefresh();d.runCB=!0;a.bind(d,"scrollend",function(){});a.bind(d,"scrollstart",function(){a.molmc.alwaysHideMask=!0});var g;a.bind(d,"refresh-release",function(){var b=this;"device"==c?a.molmc.device.showDeviceList(!0):"graphic"==c&&a.molmc.grapic.ShowRecipeList(!0);clearTimeout(g);g=setTimeout(function(){b.hideRefresh()},500);return!1});a.bind(d,"refresh-cancel",function(){clearTimeout(g)});
d.enable()},w=function(){a.molmc.alwaysHideMask=!0;var b=function(b){a.molmc.alwaysHideMask=!1;2==b.significant&&b.app_version!=a.molmc.utils.appVersion?navigator.notification.confirm(_lang("g_app_signigicant_update")+"\n"+_lang("app_update_changes"),function(b){1===b?A():2===b&&setTimeout(function(){a.molmc.utils.exitApp()},500)},_lang("me_updateprom"),_lang("g_btn_yes")+","+_lang("g_btn_no")):("1"==b.significant&&b.app_version!=a.molmc.utils.appVersion&&navigator.notification.confirm(_lang("me_updateinfo")+
"\n"+_lang("app_update_changes"),function(a){1===a&&A()},_lang("me_updateprom"),_lang("g_btn_yes")+","+_lang("g_btn_no")),e(),c(b.app_version,a.molmc.utils.appVersion)?(a("#newVersionFlag").css("display","inline-block"),a("#newVersionFlag_footer").show()):x(),a.molmc.utils.setItem("appVerInServer",b.app_version))};a.molmc.utils.checkNetwork&&a.molmc.api.checkVersion(b)},z=function(){var b=a("#old_resetpassword").val(),c=a("#newpw_resetpassword").val(),h=a("#repw_resetpassword").val();if(0===b.length||
0===c.length||0===h.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(b===h)return navigator.notification.confirm(_lang("g_error_oldpwdeqnew"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(c!==h)return navigator.notification.confirm(_lang("g_error_2pwdnotsame"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(6>c.length)return navigator.notification.confirm(_lang("g_error_pwdatleast6"),
function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(2>a.molmc.utils.checkPassword(c))return navigator.notification.confirm(_lang("g_error_pwdatleast2mode"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;b={account:d(),cur_password:b,new_password:c};a.molmc.api.newPwd(b,function(b){a("#old_resetpassword").val("");a("#newpw_resetpassword").val("");a("#repw_resetpassword").val("");navigator.notification.confirm(_lang("g_newpwd_succ"),function(){a(document).trigger("applogout");
a.molmc.app.Logout();a.ui.loadContent("#login",!1,!1,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"))})},x=function(){a("#newVersionFlag").css("display","none");a("#newVersionFlag_footer").hide()},A=function(){a.molmc.utils.setItem("autoLogin",!1);var b=new FileTransfer,c=serverURL+"/downloads/apps/IntoRobot.apk",d="/sdcard/IntoRobot/"+c.substr(c.lastIndexOf("/")+1);navigator.StatusBarNotification.notify(_lang("me_downprompt"),_lang("me_downloading"),Flag.FLAG_AUTO_CANCEL);b.download(c,
d,function(a){navigator.StatusBarNotification.clear();navigator.notification.beep(1);navigator.StatusBarNotification.notify(_lang("me_downprompt"),_lang("me_downloaded"),Flag.FLAG_AUTO_CANCEL,!0)},function(a){navigator.StatusBarNotification.notify(_lang("me_downprompt"),_lang("me_downfail"),Flag.FLAG_AUTO_CANCEL);navigator.notification.confirm(_lang("explore_downloadfailed"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm"))},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}})},
y=function(){Wechat.isInstalled(function(b){b?a.molmc.api.getAuthState(function(a){Wechat.auth("snsapi_userinfo",a.state,function(b){B(b.code,a.state)},function(a){})}):a.os.android&&navigator.notification.confirm(_lang("wechat_not_install"),function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"))},function(a){})},B=function(b,c){a.molmc.api.authCodeToAccessToken(b,c,function(b){h(b);a.molmc.utils.setItem("nickName",b.name);a.molmc.utils.setItem(b.uid,b.imgurl);a.molmc.utils.setItem("autoLogin",
!0);a.molmc.utils.setItem("loginType","wechat");a.ui.loadContent("#device",!1,!1,"slide")},function(b){a.molmc.utils.setItem("nickName",b.name);a.molmc.utils.setItem("headUrl",b.imgurl);a.molmc.utils.setItem("loginType","wechat");a.ui.loadContent("#bind",!1,!1,"slide")})},E=function(){YCQQ.checkClientInstalled(function(){YCQQ.ssoLogin(function(b){a.molmc.api.getQQAuthInfo("1104708258",b.access_token,b.userid,function(c){F(b.userid,c);a.molmc.utils.setItem("openid",b.userid);a.molmc.utils.setItem("nickName",
c.nickname);a.molmc.utils.setItem("headUrl",c.figureurl_qq_2);a.molmc.utils.setItem("loginType","qq")})},function(a){},0)},function(){navigator.notification.confirm(_lang("qq_not_install"),function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"))})},F=function(b,c){a.molmc.api.authSearch({openid:b},function(b){h(b);"null"!==a.molmc.utils.getItem("headUrl")&void 0!==a.molmc.utils.getItem("headUrl")&&a.molmc.utils.setItem(b.uid,a.molmc.utils.getItem("headUrl"));a.molmc.utils.setItem("autoLogin",
!0);a.ui.loadContent("#device",!1,!1,"slide")},function(b){a.ui.loadContent("#bind",!1,!1,"slide")})},m=function(){var b=a.molmc.utils.getItem("nickName"),c=a("#email_bind").val(),d=a("#pwd_bind").val();if(0===c.length||0===d.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(6>d.length)return navigator.notification.confirm(_lang("g_error_pwdatleast6"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),
!1;if(!a.molmc.utils.checkEmail(c)&&!a.molmc.utils.checkPhone(c))return navigator.notification.confirm(_lang("g_error_emailphoneformat"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;b="wechat"===a.molmc.utils.getItem("loginType")?{bind:!0,account:c,name:b,password:d}:{bind:!0,openid:a.molmc.utils.getItem("openid"),account:c,name:b,password:d};a.molmc.api.authBind(b,function(b){h(b);"null"!==a.molmc.utils.getItem("headUrl")&&void 0!==a.molmc.utils.getItem("headUrl")&&a.molmc.utils.setItem(b.uid,
a.molmc.utils.getItem("headUrl"));a.molmc.utils.setItem("autoLogin",!0);a.molmc.utils.setItem("account",c);a.ui.loadContent("#device",!1,!1,"slide")},function(b){605===b?navigator.notification.confirm(_lang("bind_nouser_content"),function(b){1===b&&a.ui.loadContent("#register",!1,!1,"slide")},_lang("g_tips_error"),_lang("g_btn_confirm")+","+_lang("g_btn_cancel")):606===b&&navigator.notification.confirm(_lang("bind_unactived_content"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm"))})},
h=function(b){a.molmc.utils.setItem("uid",b.uid);a.molmc.utils.setItem("email",b.email);a.molmc.utils.setItem("phone",b.phone);a.molmc.utils.setItem("u_topic",b.u_topic);a.molmc.utils.setItem("username",b.username);a.molmc.utils.setItem("nickname",b.nickname);a.molmc.utils.setItem("userlevel",b.userlevel);a.molmc.utils.setItem("login_at",b.login_at);a.molmc.utils.setItem("id",b.id);a.molmc.utils.setItem("keepstay",b.keepstay)};f.prototype={Login:function(b){var c=a("#account_login").val();b=a("#pwd_login").val();
if(0===c.length||0===b.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;b={account:c,password:b,keepstay:!0};var d=function(b){h(b);a.molmc.utils.setItem("account",c);a.molmc.utils.setItem("loginType","intorobot");a.molmc.utils.setItem("autoLogin",!0);a("#pwd_login").val("");a.ui.loadContent("#device",!1,!1,"slide")};a.molmc.utils.checkEmail(c)||a.molmc.utils.checkPhone(c)?a.molmc.api.login(b,d):navigator.notification.confirm(_lang("g_error_emailphoneformat"),
function(){},_lang("g_tips_error"),_lang("g_tips_confirm"))},Register:function(b,c,d,g,q,h){var G;if(0===b.length||0===c.length||0===d.length||0===g.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(6>d.length)return navigator.notification.confirm(_lang("g_error_pwdatleast6"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(2>a.molmc.utils.checkPassword(d))return navigator.notification.confirm(_lang("g_error_pwdatleast2mode"),
function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(!a.molmc.utils.checkEmail(c)&&!a.molmc.utils.checkPhone(c))return navigator.notification.confirm(_lang("g_error_emailformat"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if("email"==q)G={username:b,account:c,password:d,vldCode:g,registerClient:a.molmc.utils.getClientType()};else if("phone"==q){if(void 0===h)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),
!1;q=h.replace(/\+/,"00");G={username:b,account:c,password:d,vldCode:g,zone:q,registerClient:a.molmc.utils.getClientType()}}a.molmc.api.register(G,function(){var b;b=a.molmc.utils.checkPhone(c)?_lang("g_succ_phone_register"):_lang("g_succ_register");navigator.notification.confirm(b,function(){a.ui.loadContent("#login",!1,!1,"slide")},_lang("g_tips_success"),_lang("g_tips_confirm"))})},ChangevldCode:function(){l()},Forgetpw:function(){var b=a("#account_forgetpw").val(),c={account:b},d=function(b){a.molmc.utils.showToast(_lang("g_tip_getvldcode"),
250,3E3);a.ui.loadContent("#resetpw",!1,!1,"slide")};a.molmc.utils.checkEmail(b)||a.molmc.utils.checkPhone(b)?a.molmc.utils.checkEmail(b)?a.molmc.api.forgetpw(c,d):a.ui.loadContent("#resetpwd2",!1,!1,"slide"):navigator.notification.confirm(_lang("g_error_emailphoneformat"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm"))},Resetpw:function(b,c,d){if(0===b.length||0===c.length||0===d.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),
_lang("g_tips_confirm")),!1;if(c!==d)return navigator.notification.confirm(_lang("g_error_2pwdnotsame"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(6>c.length)return navigator.notification.confirm(_lang("g_error_pwdatleast6"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(2>a.molmc.utils.checkPassword(c))return navigator.notification.confirm(_lang("g_error_pwdatleast2mode"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;a.molmc.api.resetpw({vldCode:b,
password:c},function(b){a.molmc.utils.showToast(_lang("g_succ_resetpw"),250,3E3);a.ui.loadContent("#login",!1,!1,"slide")})},Feedback:function(){var b=a("#text_feedback").val(),c={content:b},d=function(){navigator.notification.confirm(_lang("g_succ_feedback_thanks"),function(){},_lang("g_tips_success"),_lang("g_tips_confirm"));a.ui.goBack()};0===b.length?navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")):a.molmc.api.feedback(d,c)},
Logout:function(){a.molmc.utils.setItem("autoLogin",!1);a("#defaultHeader .backButton").show();"qq"==a.molmc.utils.getItem("loginType")&&YCQQ.logout(function(){},function(a){});a.molmc.api.logout()}};a.molmc.app=new f})(af);
(function(a){var b={},f=function(){var g=this,q=!1;b.hasOnUtopic=!1;b.status=[];a(document).on("applogout",function(){b={status:[]};g.offSubUtopic();a.molmc.mainMqtt.disconnect();a.molmc.mainMqtt={}});a("#device").bind("loadpanel",function(){a(".backButton").hide();a(".fa-ellipsis-v").css({padding:"10px 25px"});a.molmc.utils.u_Topic="mqtt:v1/"+a.molmc.utils.getItem("u_topic")+"/channel/userDevice/cmd/updata";a("#popup_adddevice").html("");a("#popup_adddevice").attr("data-status","device");a("#popup_adddevice").addClass("fa fa-ellipsis-v").removeClass("button");
a.molmc.utils.getItem(!1)&&navigator.splashscreen.hide();a("#header_device h1").html(_lang("g_title_device"));g.isUtopicInDevPanel(!0);n()});a("#device").bind("unloadpanel",function(){a(".backButton").show();g.isUtopicInDevPanel("none")});a("#widgets_device").bind("loadpanel",function(){a(".backButton").show();a("#popup_adddevice").html("");a("#popup_adddevice").attr("data-status","widgetList");a("#popup_adddevice").addClass("fa fa-ellipsis-v").removeClass("button");a("#header_device h1").html(b.Device.name);
a.molmc.utils.showWidgets(a("#widgetList_device"),b.Device.widgets,!0);setTimeout(function(){y(b.Device.widgets,a.molmc.mainMqtt)},500);g.isUtopicInDevPanel("notify")});a("#widgets_device").bind("unloadpanel",function(){a.molmc.goShowWidget||a.molmc.mainMqtt.unsubscribeAll()});a("#showWidget_device").bind("loadpanel",function(){g.isUtopicInDevPanel("notify");a("#popup_adddevice").attr("data-status","widget");a("#header_device h1").html(b.curWidget.name);C()});a("#demo_device").bind("loadpanel",function(){a("#defaultHeader .backButton").show();
var c=function(c){b.demoDevList=c;var d;if(void 0===c)d=void 0;else{d=[];for(var r=[],g=0,q=c.length;g<q;g++){var D;D=[];-1===d.indexOf(c[g].category)?(d.push(c[g].category),D.push(c[g]),D={name:c[g].category,list:D},r.push(D)):r[d.indexOf(c[g].category)].list.push(c[g])}d=r}c=a("#demoList_device");if(!_.isEmpty(d))for(c.empty(),r=0,g=d.length;r<g;r++){void 0!==d[r].name&&c.append('<li class="divider"><div><label style="width:auto;padding:3px 3px">'+d[r].name+'</label><div style="clear:both;"></div></div></li>');
q=d[r].list;D=0;for(var G=q.length;D<G;D++){var h=q[D].dev_img;""==h||void 0==h?h="/assets/img/intodunio.png":/^[^\/]+/.test(h)&&(h="/"+h);c.append('<li data-id="'+q[D]._id+'"><div style="float:left"><img style="width:80px;height:80px;margin-top:-8px;border-radius:50%;" src="'+serverURL+h+'"></div><div style="margin-left:90px;height:65px;"><h3 style="color:rgb(93,93,216);margin-top:-5px;width:80%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">'+q[D].name+'</h3><h4 class="nowrap"  style="color:gray;margin-top:5px;">'+
q[D].description+"</h4></div></li>")}}};_.isEmpty(b.demoDevList)&&a.molmc.api.getDemoDevList(c)});a("#demo_device").on("tap","li",function(b){b=b.currentTarget.attributes[0].value;"divider"!==b&&a.molmc.explore.getDevices(b,!0)});a("#collectdev_device").bind("loadpanel",function(){a.molmc.api.searchCollectDevices(function(c){b.collectDevice=c;if(_.isEmpty(c))a.molmc.utils.shownullDev(a("#collectdevList_device"),"collect");else{c=a("#collectdevList_device");var d=b.collectDevice;if(!_.isEmpty(d)){c.empty();
for(var g=0;g<d.length;g++){var r=d[g].dev_img;""==r||void 0==r?r="/assets/img/intodunio.png":/^[^\/]+/.test(r)&&(r="/"+r);c.append('<li id="'+g+'"><div style="float:left"><img style="width:80px;height:80px;margin-top:-8px;border-radius:50%;" src="'+serverURL+r+'"></div><div style="margin-left:90px;height:65px;"><h3 style="color:rgb(93,93,216);margin-top:-5px;width:80%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">'+d[g].name+'</h3><h4 class="nowrap"  style="color:gray;margin-top:5px;">'+
d[g].description+'</h4><h4 style="color:rgb(42, 132, 197);margin-top:5px;margin-left:5px;"><span class="icon location" style="margin:-5px;"></span>'+d[g].city+"</h4></div></li>")}}}})});a("#collectdev_device").on("tap","li",function(c){a.molmc.explore.getDevices(b.collectDevice[c.currentTarget.id].device_id,void 0,c.currentTarget.id,b.collectDevice[c.currentTarget.id]._id)});a("#collectdev_device").on("longTap","li",function(c){var d='<div style="font-size:20px"><span class="fa fa-info-circle padding5" id="check_collect_device"> '+
_lang("device_view")+'</span><hr><span class="fa fa-trash padding5" id="delete_collectdev_device"> '+_lang("device_delfavo")+"</span></div>",g=a.ui.popup({id:"popup_delete_collect",title:"Alert! Alert!",message:d,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm done!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!0,posOffset:50});a("#check_collect_device").bind("tap",function(){var d=b.collectDevice[c.currentTarget.id].device_id;g.hide();a.molmc.explore.getDevices(d)});
a("#delete_collectdev_device").bind("tap",function(){var a=b.collectDevice[c.currentTarget.id]._id;g.hide();m(a,c.currentTarget.id)})});a("#device").on("tap","li",function(c){b.Device=b.Devices[c.currentTarget.id];1===b.Device.widgets.length?(a.molmc.goShowWidget=!0,b.curWidget=b.Device.widgets[0],A(b.Device.widgets,a.molmc.mainMqtt),setTimeout(function(){a.ui.loadContent("#showWidget_device",!1,!1,"slide")},50)):a.ui.loadContent("#widgets_device",!1,!1,"slide")});a("#device").on("longTap","li",function(c){navigator.notification.vibrate(50);
var d='<div style="font-size:20px"><span class="fa fa-info-circle padding5 width100" id="check_device"> '+_lang("device_info")+'</span><hr><span class="fa fa-trash padding5 width100" id="delete_dev_device"> '+_lang("device_deldev")+"</span></div>",g=a.ui.popup({id:"popup_delete_collect",title:"Alert! Alert!",message:d,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm do!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!0,posOffset:50});a("#check_device").bind("tap",
function(){b.Device=b.Devices[c.currentTarget.id];g.hide();a.ui.loadContent("#deviceinfo_device",!1,!1,"slide")});a("#delete_dev_device").bind("tap",function(){g.hide();var d=function(){a.molmc.device.publishDevInfoNew();b.Devices.splice(c.currentTarget.id,1);0===b.Devices.length?a.molmc.utils.shownullDev(a("#deviceList_device"),"mydev"):a.molmc.utils.showDevices(a("#deviceList_device"),b.Devices)},q=[_lang("g_btn_cancel"),_lang("g_btn_confirm")];navigator.notification.confirm(_lang("device_delete_confirm"),
function(g){2===g&&a.molmc.api.deleteDevice(b.Devices[c.currentTarget.id]._id,d)},_lang("device_deldev"),q)})});a("#widgets_device").on("tap","li",function(c){a.molmc.goShowWidget=!0;b.curWidget=b.Device.widgets[c.currentTarget.id];a.ui.loadContent("#showWidget_device",!1,!1,"slide")});a("#popup_adddevice").bind("tap",function(){var c="";if("device"===a("#popup_adddevice").attr("data-status"))c='<div style="font-size:17px;bottom-border:1px solid;"><span class="fa fa-cogs padding5 width100" id="pop_config_device"> '+
_lang("device_adddevice")+"</span></div>",c=c+'<div style="font-size:17px"><span class="fa fa-cube padding5 width100" id="pop_collectdev_device"> '+_lang("device_favourite")+"</span></div>",c=c+'<div style="font-size:17px"><span class="fa fa-cubes padding5 width100" id="pop_demo_device"> '+_lang("device_demo")+"</span></div>";else{var d='<div style="font-size:17px;bottom-border:1px solid;"><span class="fa fa-gears padding5 width100" id="pop_bind_device"> '+_lang("device_bind")+"</span></div>";"widgetList"===
a("#popup_adddevice").attr("data-status")?c=d:"widget"===a("#popup_adddevice").attr("data-status")?(c=x(b.curWidget)?'<div style="font-size:17px;bottom-border:1px solid;"><span class="fa fa-line-chart padding5 width100" id="pop_history_device"> '+_lang("device_showhistoryinfo")+"</span></div>":"",1==b.Device.widgets.length&&(c+=d)):"history"===a("#popup_adddevice").attr("data-status")&&(c='<div style="font-size:17px;bottom-border:1px solid;"><span class="fa fa-tachometer padding5 width100" id="pop_widget_device"> '+
_lang("device_showwidget")+"</span></div>");!0===b.Device.isPublic&&(c=c+'<div style="font-size:17px"><span class="fa fa-wechat padding5 width100" id="pop_sendtosession_device"> '+_lang("device_sharetoSession")+"</span></div>",c=c+'<div style="font-size:17px"><span class="fa fa-share-square-o padding5 width100" id="pop_sharetotimeline_device"> '+_lang("device_sharetoTimeline")+"</span></div>",c=c+'<div style="font-size:17px"><span class="fa fa-qq padding5 width100" id="pop_sharetoqq_device"> '+_lang("device_sharetoqq")+
"</span></div>")}var g=a.ui.popup({id:"popup_add",title:"Alert! Alert!",message:c,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm done!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!0,posOffset:50});a("#popup_add").css({left:"auto",top:"45px",width:"auto",right:"0",padding:"0","border-radius":"0"});a("#popup_add #pop_collectdev_device").bind("tap",function(){g.hide();a.ui.loadContent("#collectdev_device",!1,!1,"slide")});a("#popup_add #pop_config_device").bind("tap",
function(){g.hide();b.isCreateDev=!0;"true"===a.molmc.utils.getItem("firstConfig")?a.ui.loadContent("#step1_configdev",!1,!1,"slide"):a.os.ios?a.ui.loadContent("#esptouch",!1,!1,"slide"):a.ui.loadContent("#deviceconfig",!1,!1,"slide")});a("#popup_add #pop_demo_device").bind("tap",function(){g.hide();a.ui.loadContent("#demo_device",!1,!1,"slide")});a("#popup_add #pop_history_device").bind("tap",function(){g.hide();v()});a("#popup_add #pop_widget_device").bind("tap",function(){g.hide();C()});a("#popup_add #pop_bind_device").bind("tap",
function(){g.hide();b.isCreateDev=!1;"true"===a.molmc.utils.getItem("firstConfig")?a.ui.loadContent("#step1_configdev",!1,!1,"slide"):a.os.ios?a.ui.loadContent("#esptouch",!1,!1,"slide"):a.ui.loadContent("#deviceconfig",!1,!1,"slide")});a("#popup_add #pop_sendtosession_device").bind("tap",function(){g.hide();var c=_.findWhere(b.Tokens,{device_id:b.Device._id,isPublic:!0,clientType:"user"});"widgetList"===a("#popup_adddevice").attr("data-status")?e("session",b.Device,c):e("session",b.Device,c,b.curWidget)});
a("#popup_add #pop_sharetotimeline_device").bind("tap",function(){g.hide();var c=_.findWhere(b.Tokens,{device_id:b.Device._id,isPublic:!0,clientType:"user"});"widgetList"===a("#popup_adddevice").attr("data-status")?e("timeline",b.Device,c):e("timeline",b.Device,c,b.curWidget)});a("#popup_add #pop_sharetoqq_device").bind("tap",function(){g.hide();"widgetList"===a("#popup_adddevice").attr("data-status")?k(b.Device):k(b.Device,b.curWidget)})});a("#deviceinfo_device").bind("loadpanel",function(){g.isUtopicInDevPanel("notify");
var c=serverURL+"/"+b.Device.dev_img;a("#deviceinfo_device img").attr("src",c);b.Device.activated?a("#isactivate").html(_lang("g_btn_yes")):a("#isactivate").html(_lang("g_btn_no"));a("#dev_description_device").html(b.Device.description);a("#curdev_id_explore").html(b.Device._id);b.Device.isPublic?(a("#curdev_isshared_device").html(_lang("device_sharetype_public")),a("#devShareType_device").show(),a("#divider_share_device").show(),a("#toggle_share_status").attr("checked","checked"),a("#toggle_share_status").prop("checked",
!0),a("#toggle_share_status").val(1),1===b.Device.shareType?(a("#curdev_sharestatus_device").html(_lang("device_sharetype_readonly")),a("#devShareType_device").show(),a("#divider_share_device").show(),a("#toggle_setshare").removeAttr("checked","checked"),a("#toggle_setshare").prop("checked",!1),a("#toggle_setshare").val(0)):2===b.Device.shareType&&(a("#devShareType_device").show(),a("#divider_share_device").show(),a("#toggle_setshare").attr("checked","checked"),a("#toggle_setshare").prop("checked",
!0),a("#curdev_sharestatus_device").html(_lang("device_sharetype_rw")),a("#toggle_setshare").val(1))):(a("#curdev_isshared_device").html(_lang("device_sharetype_private")),a("#toggle_share_status").removeAttr("checked"),a("#toggle_share_status").prop("checked",!1),a("#toggle_share_status").val(0),a("#devShareType_device").hide(),a("#divider_share_device").hide());a("#city_device").html(b.Device.city);a("#curdev_info_device").html(b.Device.name)});a("#deviceinfo_device").on("tap","img",function(){var c=
'<div style="font-size:20px"><div class="fa fa-camera padding5 width100" id="camera_device"> '+_lang("tips_camera")+'</div><hr><div class="fa fa-image padding5 width100" id="album_device"> '+_lang("tips_albums")+"</div></div>",d=a.ui.popup({id:"popup_changehead_device",title:"Alert! Alert!",message:c,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm do!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!0,posOffset:50}),g=function(c){(new Date).getTime();
h(c,b.Device._id,function(c){a.molmc.device.publishDevInfoNew();c=b.Device._id;b.Device.dev_img="/v1/avatars/"+c;a.molmc.api.updateDeviceInfo(b.Device._id,b.Device,function(a){p()});c=serverURL+"/v1/avatars/"+c;a("#deviceinfo_device img").attr("src",c)})},r=function(b){a.molmc.utils.showToast(_lang("tips_devimg_updatefail"),280,3E3)};a("#camera_device").bind("tap",function(){navigator.camera.getPicture(g,r,{quality:75,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,
allowEdit:!0,targetWidth:128,targetHeight:128});d.hide()});a("#album_device").bind("tap",function(){navigator.camera.getPicture(g,r,{quality:75,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,targetWidth:128,targetHeight:128});d.hide()})});a("#device").on("tap","#addDeviceEmpty",function(){b.isCreateDev=!0;a.molmc.utils.getItem("firstConfig");"true"===a.molmc.utils.getItem("firstConfig")?a.ui.loadContent("#step1_configdev",!1,!1,"slide"):
a.os.ios?a.ui.loadContent("#esptouch",!1,!1,"slide"):a.ui.loadContent("#deviceconfig",!1,!1,"slide")});var f;a("#step1_configdev").bind("loadpanel",function(){a(".backButton").show();var d=0,g=0;a("#btn_next").attr("value","0");a("#btn_next").hide();a("#redlight_device").css("color","black");a.molmc.utils.getLocation(function(a){b.point=a;require(["vendor/map.quick"],function(c){c.initMap("myExploreMap",{lng:a.lng,lat:a.lat,layer:5},{minZoom:4,maxZoom:16});c.LocalByPoint(a,function(a){void 0==a&&
(a="\u5317\u4eac\u5e02");b.city=a})})});f=setInterval(function(){0===d?(5<g?a("#redlight_device").css("color","red"):a("#press_btn_device").css("font-size","1.5em"),d=1):(5<g?a("#redlight_device").css("color","black"):a("#press_btn_device").css("font-size","1.3em"),d=0);g++},500);var q=function(b){a("#btn_next").show();a("#btn_next").attr("value","1")};a.os.ios?q():a.os.android&&c(q)});a("#step1_configdev").bind("unloadpanel",function(){clearInterval(f)});a("#btn_next").bind("tap",function(){a.molmc.utils.setItem("firstConfig",
!1);"0"!==a("#btn_next").attr("value")&&(a.os.ios?a.ui.loadContent("#esptouch",!1,!1,"slide"):a.ui.loadContent("#deviceconfig",!1,!1,"slide"))});a("#smartConfig").bind("tap",function(){a.ui.loadContent("#esptouch",!1,!1,"slide")});a("#deviceconfig").bind("loadpanel",function(){a(".backButton").show();a("#btn_scane").show();!0===b.isCreateDev?a("#header_configstep2_device h1").html(_lang("device_adddevice")):a("#header_configstep2_device h1").html(_lang("device_bind"));a("#btn_scane").bind("tap",function(){c(function(a){d(a)},
!0)});a("#display_pwd").on("tap",function(){var b=a("#display_pwd").attr("value"),c=a("#wifipwd_config").val();"0"==b?(a("#display_pwd").attr("value",1),a("#display_pwd").css("color","black"),a("#pwdbox")[0].innerHTML='<input class="margintop10 disablediv" name="wifipwd" type="text" id="wifipwd_config" value="'+c+'" placeholder="'+_lang("device_config_inputpwd")+'">'):(a("#display_pwd").attr("value",0),a("#display_pwd").css("color","gray"),a("#pwdbox")[0].innerHTML='<input class="margintop10 disablediv" name="wifipwd" type="password" id="wifipwd_config" value="'+
c+'" placeholder="'+_lang("device_config_inputpwd")+'">')});var d=function(b){a.ui.hideMask();if(void 0!==b){a("#devssidList").empty();a("#wifissidList").empty();for(var c="",d="",g=0;g<b.length;g++)-1!==b[g].toLowerCase().indexOf("intorobot")&&(c=c+'<option value="'+b[g]+'">'+b[g]+"</option>"),d=d+'<option value="'+b[g]+'">'+b[g]+"</option>";""===c&&navigator.notification.confirm(_lang("device_config_notfountdev"),function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"));c='<select autofocus name="devSsid" class="disablediv">'+
c+"</select>";d='<select name="wifiSsid" class="disablediv">'+d+"</select>";a("#devssidList").append(c);a("#wifissidList").append(d)}};d(b.ssidList);a.molmc.utils.getItem("firstConfig")&&(a.molmc.utils.getLocation(function(a){b.point=a;require(["vendor/map.quick"],function(c){c.initMap("myExploreMap",{lng:a.lng,lat:a.lat,layer:5},{minZoom:4,maxZoom:16});c.LocalByPoint(a,function(a){void 0==a&&(a="\u5317\u4eac\u5e02");b.city=a})})}),void 0===b.ssidList&&c(d,!0))});a("#wifipwd_config").focus(function(b){a.os.ios?
a.ui.scrollToBottom("ios_deviceconfig"):a.os.android&&a.ui.scrollToBottom("deviceconfig")});a("#deviceconfig").bind("unloadpanel",function(){a(".backButton").hide();a("#wifipwd_config").val("");u();void 0!==b.Tokens&void 0!==a.molmc.mainMqtt&&(a.molmc.mainMqtt.disconnect(),a.molmc.device.openMainMqtt(b.Tokens))});a("#deviceconfig").on("tap",".button",function(){if(!q){a.ui.showMask(_lang("tips_configuring"));q=!0;a("#deviceconfig .button").attr("disabled","disabled");var c=a("#deviceconfig select[name='devSsid']").val(),
g=a("#deviceconfig select[name='wifiSsid']").val(),h=a("#deviceconfig input[name='wifipwd']").val(),g={devssid:c,wifissid:g,wifipwd:h},h=function(g){null===a.molmc.utils.getItem("count")&&a.molmc.utils.setItem("count",1);var q=a.molmc.utils.getItem("count");void 0===b.city&&(b.city="\u5317\u4eac\u5e02",b.point.lat=39.897445,b.point.lng=116.331398);var h={uid:a.molmc.utils.getItem("uid"),name:c+"_"+q,nickname:a.molmc.utils.getItem("username"),isPublic:!0,tags:"atom",dev_img:"assets/img/intodunio.png",
shareType:1,product_id:g,city:b.city,coordinate:[b.point.lng,b.point.lat],description:c+"_"+q},D=function(c){navigator.wificonfig.setDeviceInfo(c,function(c){u();a.molmc.mainMqtt.disconnect();c=!0!==b.isCreateDev?_lang("device_bind")+_lang("g_success"):_lang("device_create")+" "+h.name+" "+_lang("g_success");navigator.notification.confirm(c,function(){a.ui.loadContent("#device",!1,!0,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"));a.molmc.device.openMainMqtt(b.Tokens);a.molmc.device.publishDevInfoNew();
p();w();q=parseInt(q)+1;a.molmc.utils.setItem("count",q)},d)},e=0,m=setInterval(function(){e+=1;if(navigator.network.connection.type==Connection.WIFI){if(!0===b.isCreateDev)a.molmc.api.createDevice(h,D,function(a){d("112")});else{var c=b.Device._id,g=_.findWhere(b.Tokens,{device_id:c,isPublic:!1,clientType:"device"});D({device_id:c,access_token:g.access_token})}clearInterval(m)}20<e&&clearInterval(m)},300)};setTimeout(function(){q=!1;a("#deviceconfig .button").removeAttr("disabled")},5E3);"0"==a("#btn_devconfig").val()?
(a("#btn_devconfig").html(_lang("device_underconfig")),a("#btn_devconfig").val("1"),a(".disablediv").attr("disabled","disabled"),navigator.wificonfig.createDevice(g,"connect",h,d)):"1"==a("#btn_devconfig").val()&&(u(),navigator.wificonfig.cancelConfig())}});a("#deviceinfo_device").on("tap","#curdev_info_device_td",function(){a.ui.loadContent("#editdevinfo_device",!1,!1,"slide")});a("#editdevinfo_device").bind("loadpanel",function(){a("#editdevinfo_device input").val(b.Device.name);a("#editdevinfo_device textarea").val(b.Device.description)});
a("#header_editdevinfo_device .button").bind("tap",function(){var c=a("#editdevinfo_device input").val(),g=a("#editdevinfo_device textarea").val();0===c.length||0===g?navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")):a.molmc.utils.checkInput(c)?a.molmc.utils.checkdevDespInput(g)?(b.Device.name=c,b.Device.description=g,a.molmc.api.updateDeviceInfo(b.Device._id,b.Device,function(b){a.molmc.device.publishDevInfoNew();p();a.ui.goBack()})):
navigator.notification.confirm(_lang("device_notice_desc"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")):navigator.notification.confirm(_lang("device_notice_name"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm"))});a("#toggle_share_status").bind("change",function(){var c=_.findWhere(b.Tokens,{device_id:b.Device._id,isPublic:!0,clientType:"user"});if(1==a("#toggle_share_status").val())_.isEmpty(c)||(c.access_control[b.Device._id]=0,a.molmc.api.updateDevToken(c,function(b){a.molmc.device.publishDevInfoNew();
a("#devShareType_device").hide();a("#divider_share_device").hide();p();w()}),a("#toggle_share_status").val(0),a("#curdev_isshared_device").html(_lang("device_sharetype_private")));else{var g=function(b){a.molmc.device.publishDevInfoNew();a("#devShareType_device").show();a("#divider_share_device").show();p();w()};_.isEmpty(c)?(c={},c.uid=a.molmc.utils.getItem("uid"),c.isPublic=!0,c.device_id=b.Device._id,c.clientType="user",c.ttl=0,c.access_control={},c.access_control[b.Device._id]=1,a.molmc.api.createDevToken(c,
g)):(c.isPublic=!0,c.access_control[b.Device._id]=1,a.molmc.api.updateDevToken(c,g));a("#toggle_share_status").val(1);a("#curdev_isshared_device").html(_lang("device_sharetype_public"))}});a("#toggle_setshare").bind("change",function(){var c=_.findWhere(b.Tokens,{device_id:b.Device._id,isPublic:!0,clientType:"user"}),g=function(){a.molmc.device.publishDevInfoNew();p();w()};1==a("#toggle_setshare").val()?_.isEmpty(c)||(c.access_control[b.Device._id]=1,a.molmc.api.updateDevToken(c,g),a("#toggle_setshare").val(0),
a("#curdev_sharestatus_device").html(_lang("device_sharetype_readonly"))):_.isEmpty(c)||(c.access_control[b.Device._id]=2,a.molmc.api.updateDevToken(c,g),a("#toggle_setshare").val(1),a("#curdev_sharestatus_device").html(_lang("device_sharetype_rw")))})},c=function(c,d){navigator.wificonfig.getSsidList(function(d){b.ssidList=d;c(d);a.ui.hideMask()},function(b){a.ui.hideMask()});!0===d&&a.ui.showMask(_lang("device_wifi_scanning"))},d=function(a){u();var b="("+_lang("error_code")+" : "+a+") ";"100"==
a?b+=_lang("tcp_first_create_failed"):"101"==a?b+=_lang("tcp_second_create_failed"):"102"==a?b+=_lang("tcp_data_send_failed"):"103"==a?b+=_lang("tcp_data_receive_failed"):"104"==a?b+=_lang("tcp_disconnect_error"):"105"==a?b+=_lang("tcp_connect_timeout"):"106"==a?b+=_lang("tcp_json_parse_failed"):"107"==a?b+=_lang("tcp_hand_atom_failed"):"108"==a?b+=_lang("wifi_connect_atom_failed"):"109"==a?b+=_lang("wifi_reconnect_atom_failed"):"110"==a?b+=_lang("atom_connect_wifi_timeout"):"111"==a?b+=_lang("atom_receive_wifiinfo_failed"):
"112"==a&&(b+=_lang("atom_set_devinfo_failed"));navigator.notification.confirm(b,function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"))},e=function(a,b,c,d){var h=Wechat.Scene.TIMELINE,e=_lang("wechat_share_title"),r="",m="";void 0!==d&&(m="&widget_id="+d.widget_id);"session"===a?(h=Wechat.Scene.SESSION,r=_lang("device_devname")+": "+b.name+"\n"+_lang("device_description")+": "+b.description+"\n"+_lang("device_city")+": "+b.city):"timeline"===a&&(h=Wechat.Scene.TIMELINE,1==c.access_control[b._id]?
e="; \u5c0f\u4f19\u4f34\u4eec\u5feb\u8fc7\u6765\u56f4\u89c2\u5427\uff5e":2==c.access_control[b._id]&&(e="; \u5c0f\u4f19\u4f34\u4eec\u5feb\u8fc7\u6765\u63a7\u5236\u4e0b,\u975e\u5e38\u6709\u8da3\u54e6\uff5e"),e="\u6211\u5206\u4eab\u4e86\u6765\u81ea"+b.city+"\u7684\u8bbe\u5907"+b.name+e);var H=b.dev_img;if(""===H||void 0===H)H="assets/img/intodunio.png";Wechat.isInstalled(function(a){"0"==a?navigator.notification.confirm(_lang("wechat_not_install"),function(){},_lang("tips_title_tips"),_lang("g_tips_confirm")):
Wechat.share({message:{title:e,description:r,thumb:serverURL+"/"+H,mediaTagName:"IntoRobot-TAG",messageExt:"IntoRObot",messageAction:"<action>dotalist</action>",media:{type:Wechat.Type.WEBPAGE,webpageUrl:serverURL+"/share/www/index.html?device_id="+b._id+m}},scene:h},function(){},function(a){-1===a.indexOf("\u53d6\u6d88\u5e76\u8fd4\u56de")&&navigator.notification.confirm(_lang("wechat_share_err"),function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"))})},function(a){navigator.notification.confirm(_lang("wechat_install_err"),
function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"))})},k=function(a,b){var c={},d="",h=a.dev_img;if(""===h||void 0===h)h="assets/img/intodunio.png";void 0!==b&&(d="&widget_id="+b.widget_id);c.url=serverURL+"/share/www/index.html?device_id="+a._id+d;c.title=_lang("wechat_share_title");c.description=_lang("device_devname")+": "+a.name+"\n"+_lang("device_description")+": "+a.description+"\n"+_lang("device_city")+": "+a.city;c.imageUrl=serverURL+"/"+h;c.appName="IntoRobot";YCQQ.shareToQQ(function(){},
function(a){},c)},l=function(b){var c;a.each(b,function(a){if("user"===b[a].clientType&&!1===b[a].isPublic)return c=b[a].access_token,!1});return c},n=function(c){var d=function(c){b.Tokens=c;a.molmc.device.openMainMqtt(c)},h=function(h){b.Devices=h;a.molmc.alwaysHideMask=!1;void 0===b.Tokens|!0===c&&a.molmc.api.getTokens(d);a.molmc.utils.showDevices(a("#deviceList_device"),h);z(b.Devices);f.prototype.onSubUtopic()};a.molmc.utils.checkNetwork()&&t(h,c)},t=function(c,d){void 0===b.Devices|!0===d?a.molmc.api.getDevices(c):
(a.molmc.utils.showDevices(a("#deviceList_device"),b.Devices),z(b.Devices))},p=function(){a.molmc.api.getDevices(function(a){b.Devices=a})},w=function(){a.molmc.api.getTokens(function(a){b.Tokens=a})},z=function(c){if(void 0!==c.length){var d=a("#deviceList_device")[0].children;a.each(d,function(h){var e=c[d[h].id];if(void 0!==e){var m=e._id;e.isPublic?(a(d[h]).find(".share").addClass("fa-share-alt"),a(d[h]).find(".share").css("color","limegreen")):a(d[h]).find(".share").removeClass("fa-share-alt");
if(!0===e.activated){var f=function(c){"online"==b.status[c]?(a(d[c]).find(".link").removeClass("fa-unlink").addClass("fa-link"),a(d[c]).find(".link").css("color","limegreen")):(a(d[c]).find(".link").removeClass("fa-link").addClass("fa-unlink"),a(d[c]).find(".link").css("color","darkgrey"))};a.molmc.mainMqtt.subscribe("v1/"+m+"/platform/default/info/online",2,function(c){b.status[h]=a.parseJSON(c.payloadString).key;f(h)});f(h)}}})}},x=function(a){if(void 0===a||void 0===a.topics)return!1;for(var b=
0;b<a.topics.length;b++)if(a.topics[b].history)return!0;return!1},A=function(a,c){var d=_.filter(a[0].topics,function(a){return!0===a.isData});!1!==a[0].isShow&&0<d.length&&c.subscribe("v1/"+b.Device._id+d[0].url,2,function(b){a[0].retain=b.payloadString})},y=function(c,d){var h=a("#widgetList_device")[0].children;a.each(h,function(e){var m=c[h[e].id],f=_.filter(m.topics,function(a){return!0===a.isData});if(!1!==m.isShow){var r="v1/"+b.Device._id+f[0].url;0<f.length&&d.unsubscribe(r,function(){d.subscribe(r,
2,function(b){if("BOOL"===c[h[e].id].topics[0].D_type){var d="",d="1"==b.payloadString?_lang("g_on"):_lang("g_off");a("#badge",a(h[e])).html(d)}else d=c[h[e].id].topics[0].attribute.unit,a("#badge",a(h[e])).html(b.payloadString+" "+d);c[h[e].id].retain=b.payloadString})})}})},B=function(a){var c=function(){b.iscollect=!1;for(var c=0;c<b.collectDevice.length;c++)a===b.collectDevice[c].device_id&&(b.iscollect=!0,b.cur_id=b.collectDevice[c]._id,c=b.collectDevice.length+1);b.iscollect||(b.cur_id=void 0)};
void 0===b.collectDevice?E(!0,c):c();return b.iscollect},E=function(c,d){var h=function(c){b.collectDevice=c;a.isFunction(d)&&d()};(c||void 0===b.collectDevice)&&a.molmc.api.searchCollectDevices(h)},F=function(b){a.molmc.api.deleteCollectDevice(b,function(){a.molmc.utils.showToast(_lang("device_unfavo_succ"),280,3E3);a("#heart_widgets_explore").removeClass("fa-heart").addClass("fa-heart-o");a("#heart_widgets_explore").css("color","gray");E(!0)})},m=function(c,d){F(c);b.collectDevice.splice(d,1);0===
b.collectDevice.length?a.molmc.utils.shownullDev(a("#collectdevList_device"),"collect"):a.molmc.utils.showDevices(a("#collectdevList_device"),b.collectDevice)},h=function(a,b,c){var d=new FileUploadOptions;d.fileKey="file";d.fileName=a.substr(a.lastIndexOf("/")+1);d.mimeType="image/jpeg";(new FileTransfer).upload(a,serverURL+"/v1/avatars?x=0&y=0&h=128&w=128&device_id="+b,c,function(a){},d)},v=function(){a("#popup_adddevice").attr("data-status","history");var c=a("#widgetPanel_device");require([fileSystemWidget+
0+"/widget.js"],function(a){a.Show(c,b.curWidget,b.Device._id)})},C=function(){a("#popup_adddevice").attr("data-status","widget");var c=a("#widgetPanel_device");require([fileSystemWidget+b.curWidget.widget_id+"/widget.js"],function(d){d.Show(a("#showWidget_device"),c,b.curWidget,b.Device._id,a.molmc.mainMqtt)})},u=function(){a.ui.hideMask();a("#btn_devconfig").html(_lang("device_config_btn"));a("#btn_devconfig").val("0");a(".disablediv").removeAttr("disabled")};f.prototype={deviceList:function(){return b.Devices},
getPrivateDev:function(a,b){t(a,b)},getTokens:function(c,d){void 0===b.Tokens|!0===d&&a.molmc.api.getTokens(c)},showDeviceList:function(a){n(a)},deletecollectDev:function(a){F(a)},deletecollectdevlist:function(a,b){m(a,b)},getisCollectDevs:function(a){return B(a)},getCollectDevs:function(a){E(a)},device_idto_id_collect:function(a){void 0===b.cur_id&&B(a);return b.cur_id},onSubUtopic:function(){!0!==b.hasOnUtopic&&(b.hasOnUtopic=!0,a.molmc.mainMqtt.on(a.molmc.utils.u_Topic,function(c){c.payloadString!=
a.molmc.utils.u_TimeStamp&&("none"===b.inDevPanel?(p(),w()):!0===b.inDevPanel?n(!0):"notify"===b.inDevPanel&&(p(),w(),navigator.notification.confirm(_lang("g_tips_devinfomod"),function(){a.ui.loadContent("#device",!1,!1,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"))))}))},hasHistoryData:function(a){return x(a)},isUtopicInDevPanel:function(a){b.inDevPanel=a},offSubUtopic:function(){a.molmc.mainMqtt.off(a.molmc.utils.u_Topic)},updataDevAndToken:function(){p();w()},shareWechat:function(a,
b,c){e(a,b,c)},shareToQQ:function(a){k(a)},isCreateDev:function(){return b.isCreateDev},getEntity:function(){return b},publishDevInfoNew:function(){var b=(new Date).getTime().toString();a.molmc.utils.u_TimeStamp=b;var c="v1/"+a.molmc.utils.getItem("u_topic")+"/channel/userDevice/cmd/updata";a.molmc.mainMqtt.publish(c,b,0,!1)},openMainMqtt:function(b){b={userName:l(b),password:a.molmc.utils.getItem("uid"),userID:a.molmc.utils.getItem("u_topic")};_.isEmpty(a.molmc.mainMqtt)?a.molmc.mainMqtt=new a.molmc.mqtt(b):
a.molmc.mainMqtt.openConnect(b)}};a.molmc.device=new f})(af);
(function(a){var b={},f,c=null,d=1,e=!1,k=function(){var f=this;n();a(document).on("applogout",function(){n()});a("#explore").bind("loadpanel",function(){a.molmc.alwaysHideMask=!0;e=!1;a.molmc.device.isUtopicInDevPanel("none");a("#header_explore h1").html(_lang("g_title_explore"));var c=0;f.searchHotDevices(function(d){if(d.length)for(var e=0;e<d.length;e++)d[e].listTag=c;b.ArrayDevice[c]=d;b.hotDevices=d;_.isEmpty(d)?b.Devicespart[c]=[p("","none")]:(b.Devicespart[c]=5<d.length?b.ArrayDevice[c].slice(0,
5):d.slice(0,d.length),b.Devicespart[c].unshift(p(_lang("explore_popdevs"),"listlabel")));_.isEmpty(b.label)?b.label=[_lang("explore_popdevs")]:b.label=b.label.concat(_lang("explore_popdevs"));1===b.Devicesshow.length||0===b.Devicesshow.length?b.Devicesshow=b.Devicespart[c]:_.isEmpty(d)||"listlabel"!=b.Devicesshow[0].typeofli||(b.Devicesshow=b.Devicesshow.concat(b.Devicespart[c]));a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0});b.tempDevices=b.Devicesshow.slice(0,
b.Devicesshow.length);c++});f.searchNearbyDevices(function(d){if(d.length)for(var e=0;e<d.length;e++)d[e].listTag=c;b.ArrayDevice[c]=d;b.nearDevices=d;_.isEmpty(d)?b.Devicespart[c]=[p("","none")]:b.Devicespart[c]=5<d.length?b.ArrayDevice[c].slice(0,5):d.slice(0,d.length);b.Devicespart[c].unshift(p(_lang("explore_nearbydevs"),"listlabel"));_.isEmpty(b.label)?b.label=[_lang("explore_nearbydevs")]:b.label=b.label.concat(_lang("explore_nearbydevs"));1===b.Devicesshow.length||0===b.Devicesshow.length?
b.Devicesshow=b.Devicespart[c]:_.isEmpty(d)||"listlabel"!=b.Devicesshow[0].typeofli||(b.Devicesshow=b.Devicesshow.concat(b.Devicespart[c]));a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0});b.tempDevices=b.Devicesshow.slice(0,b.Devicesshow.length);c++});void 0!==b.clickmorenum&&(b.ismore?("replylabel"!=b.ArrayDevice[b.clickmorenum][0].typeofli&&b.ArrayDevice[b.clickmorenum].unshift(p(b.label[b.clickmorenum],"replylabel")),b.Devicesshow=b.ArrayDevice[b.clickmorenum].slice(0,
b.ArrayDevice[b.clickmorenum].length)):b.Devicesshow=b.tempDevices.slice(0,b.tempDevices.length),a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0}));a("#popup_widList_explore").attr("data-status","exploreDeviceList");a(".backButton").hide()});a("#explore").bind("unloadpanel",function(){null!==c&&(c.style.background="inherit",c.style.color="#53575E",a("#input_search_explore").val(""));a(".backButton").show()});a("#explorewidgetHeaderBackButton").bind("tap",function(){"exploreDeviceList"===
a("#popup_widList_explore").attr("data-status")&&(b.Devicesshow=b.ismore?b.ArrayDevice[b.clickmorenum].slice(0,b.ArrayDevice[b.clickmorenum].length):b.tempDevices.slice(0,b.tempDevices.length),a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0}))});a("#widgets_explore").bind("loadpanel",function(){a("#header_widget_explore h1").html(b.CurDevice.name);a("#popup_widList_explore").html("");a("#popup_widList_explore").attr("data-status","widgetList");a("#popup_widList_explore").addClass("fa fa-ellipsis-v").removeClass("button");
a.molmc.utils.showWidgets(a("#widgetList_explore"),b.CurDevice.widgets);a("#device_name_explore").html(b.CurDevice.name);a("#location_city_explore").html(b.CurDevice.city);a("#device_creater_explore").html(b.CurDevice.description);a("#device_image_explore").attr("src",serverURL+"/"+b.CurDevice.dev_img);a("#popup_widList_explore").css({padding:"10px 25px"});!0===b.isDemoDev?(a("#heart_widgets_explore").removeClass("fa-heart-o").removeClass("fa-heart").addClass("fa-code-fork"),a("#heart_widgets_explore").css("color",
"gray"),a("#popup_widList_explore").hide()):(a("#popup_widList_explore").show(),a.molmc.device.getisCollectDevs(b.CurDevice._id)?(a("#heart_widgets_explore").removeClass("fa-heart-o").removeClass("fa-code-fork").addClass("fa-heart"),a("#heart_widgets_explore").css("color","red")):(a("#heart_widgets_explore").removeClass("fa-heart").removeClass("fa-code-fork").addClass("fa-heart-o"),a("#heart_widgets_explore").css("color","gray")));setTimeout(function(){t(b.CurDevice.widgets,a.molmc.pubMqtt)},500)});
a("#widgets_explore").bind("unloadpanel",function(){a.molmc.goShowWidget||a.molmc.mainMqtt.unsubscribeAll();!0===b.isDemoDev&&(a.ui.hideMask(),a.molmc.mainMqtt.unsubscribe(f.forkSubUrl))});var k=function(){a("#popup_widList_explore").html(_lang("device_widgetshow"));a("#popup_widList_explore").attr("data-status","history");a("#popup_widList_explore").css({padding:"5px 5px"});var c=a("#widgetPanel_explore");require([fileSystemWidget+0+"/widget.js"],function(a){a.Show(c,b.curWidget,b.CurDevice._id)})},
m=function(){a("#header_widget_explore h1").html(b.curWidget.name);a("#popup_widList_explore").html(_lang("device_historyinfo"));a("#popup_widList_explore").attr("data-status","widget");a("#popup_widList_explore").removeClass("fa fa-ellipsis-v").addClass("button");a("#popup_widList_explore").css({padding:"5px 5px"});a.molmc.device.hasHistoryData(b.curWidget)?a("#popup_widList_explore").show():a("#popup_widList_explore").hide();var c=a("#widgetPanel_explore");require([fileSystemWidget+b.curWidget.widget_id+
"/widget.js"],function(d){d.Show(a("#showWidget_explore"),c,b.curWidget,b.CurDevice._id,a.molmc.pubMqtt)})};a("#showWidget_explore").bind("loadpanel",function(){m()});a("#popup_widList_explore").bind("tap",function(){if("widgetList"===a("#popup_widList_explore").attr("data-status")){var c="";!0===b.isDemoDev&&(c='<div style="font-size:17px;bottom-border:1px solid;"><span class="fa fa-code-fork padding5 width100" id="pop_fork_explore"> '+_lang("explore_forkdemoDev")+"</span></div>");var c=c+'<div style="font-size:17px"><span class="fa fa-wechat padding5 width100" id="pop_sendtosession_explore"> '+
_lang("device_sharetoSession")+"</span></div>",c=c+'<div style="font-size:17px"><span class="fa fa-share-square-o padding5 width100" id="pop_sharetotimeline_explore"> '+_lang("device_sharetoTimeline")+"</span></div>",c=c+'<div style="font-size:17px"><span class="fa fa-qq padding5 width100" id="pop_sharetoqq_explore"> '+_lang("device_sharetoqq")+"</span></div>",d=a.ui.popup({id:"popup_add",title:"Alert! Alert!",message:c,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm done!",doneCallback:function(){},
cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!0,posOffset:50});a("#popup_add").css({left:"auto",top:"45px",right:"0",width:"auto",padding:"0","border-radius":"0"});a("#popup_add #pop_fork_explore").bind("tap",function(){d.hide();w(b.CurDevice._id,b.CurDevice.application_id)});a("#popup_add #pop_sendtosession_explore").bind("tap",function(){d.hide();a.molmc.device.shareWechat("session",b.CurDevice,b.CurToken)});a("#popup_add #pop_sharetotimeline_explore").bind("tap",function(){d.hide();a.molmc.device.shareWechat("timeline",
b.CurDevice,b.CurToken)});a("#popup_add #pop_sharetoqq_explore").bind("tap",function(){d.hide();a.molmc.device.shareToQQ(b.CurDevice)})}else"widget"===a("#popup_widList_explore").attr("data-status")?k():"history"===a("#popup_widList_explore").attr("data-status")&&m()});a("#btn_search_explore").bind("tap",function(){d=1;B()});a("#explore").on("tap","li",function(c){""!==c.currentTarget.id&&(a.molmc.device.getCollectDevs(),f.getDevices(b.Devicesshow[c.currentTarget.id]._id,void 0,c.currentTarget.id),
b.clickmorenum=b.Devicesshow[c.currentTarget.id].listTag)});a("#explore").on("tap","label",function(c){""!==c.currentTarget.id&&(b.ismore?(b.ArrayDevice[b.clickmorenum].splice(0,1),b.ismore=!1,b.Devicesshow=b.tempDevices.slice(0,b.tempDevices.length)):(b.ismore=!0,b.clickmorenum=c.currentTarget.id.substr(4),"replylabel"!=b.ArrayDevice[b.clickmorenum][0].typeofli&&b.ArrayDevice[b.clickmorenum].unshift(p(b.label[b.clickmorenum],"replylabel")),b.Devicesshow=b.ArrayDevice[b.clickmorenum].slice(0,b.ArrayDevice[b.clickmorenum].length)),
a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0}))});a("#heart_widgets_explore").on("tap",function(c){if(!0===b.isDemoDev)w(b.CurDevice._id,b.CurDevice.application_id);else{var d=a.molmc.utils.getItem("uid");c=b.CurDevice._id;var d={uid:d,device_id:c,name:b.CurDevice.name,description:b.CurDevice.description,city:b.CurDevice.city,dev_img:b.CurDevice.dev_img},e=function(b){a.molmc.utils.showToast(_lang("explore_favorsucc"),280,3E3);a.molmc.device.getCollectDevs(!0);
a("#heart_widgets_explore").removeClass("fa-heart-o").addClass("fa-heart");a("#heart_widgets_explore").css("color","red")};a.molmc.device.getisCollectDevs(c)?(c=a.molmc.device.device_idto_id_collect(c),a.molmc.device.deletecollectDev(c)):a.molmc.api.collectDevice(d,e)}});a("#widgets_explore").on("tap","li",function(c){a.molmc.goShowWidget=!0;b.curWidget=b.CurDevice.widgets[c.currentTarget.id];a.ui.loadContent("#showWidget_explore",!1,!1,"slide")});a(".label_hot").bind("tap",function(){null!==c&&(c.style.background=
"inherit",c.style.color="#53575E");c=this;c.style.background="#0088D1";c.style.color="#ffffff";d=1;B()})},l=function(b){var c=b.scroller({verticalScroll:!0,horizontalScroll:!1,infinite:!0,autoEnable:!0});c.addInfinite();a.bind(c,"infinite-scroll",function(){var b=this;a.bind(c,"infinite-scroll-end",function(){a.unbind(c,"infinite-scroll-end");b.clearInfinite();e&&(d++,B(d,20),b.scrollToBottom())})});c.enable()},n=function(){b={ArrayDevice:[],Devicespart:[],Devicesshow:[],label:[],ismore:!1};f=""},
t=function(c,d){var e=a("#widgetList_explore")[0].children;a.each(e,function(h){var f=c[e[h].id],k=_.filter(f.topics,function(a){return!0===a.isData});if(!1!==f.isShow){var x="v1/"+b.CurDevice._id+k[0].url;0<k.length&&d&&d.unsubscribe(x,function(){d.subscribe(x,2,function(b){if("BOOL"===c[e[h].id].topics[0].D_type){if("1"==b.payloadString)var d="",d=_lang("g_on");else d=_lang("g_off");a("#badge",a(e[h])).html(d)}else d=c[e[h].id].topics[0].attribute.unit,a("#badge",a(e[h])).html(b.payloadString+" "+
d);c[e[h].id].retain=b.payloadString})})}})},p=function(a,b){var c={};c.typeofli=b;c.tag=a;return c},w=function(b,c){var d=a.molmc.device.deviceList();z(d,b,c)},z=function(c,d,e){if(_.isEmpty(c))navigator.notification.confirm(_lang("g_warning_nodeveices"),function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"));else{for(var h="",f=0;f<c.length;f++)h=h+'<li data-id="'+c[f]._id+'">'+c[f].name+"</li>";var h='<ul class="list" style="overflow:auto;max-height:300px">'+h+"</ul>",k=a.ui.popup({id:"popup_List",
title:_lang("device_select_demodev"),message:h,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm done!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!1,posOffset:50});setTimeout(function(){a("#popup_List").on("tap","li",function(a){k.hide();a=a.currentTarget.attributes[0].value;b.forkDevId=a;x(a,d,e)})},500)}},x=function(b,c,d){a.ui.showMask(_lang("explore_repaintdev_tips"));a.molmc.api.repaintDemoDev(b,c,function(a){navigator.notification.confirm(_lang("explore_checkdevonline"),
function(c){1===c&&A(b,a.application_id)},_lang("tips_title_tips"),_lang("g_btn_yes")+","+_lang("g_btn_no"))})},A=function(b,c){a.ui.showMask(_lang("explore_compileapp"));a.molmc.api.compileApp(c,function(a){y(a,b)})},y=function(b,c){var d="v1/"+c+"/platform/default/info/notify",e="v1/"+c+"/firmware/default/action/flash";a.molmc.mainMqtt.subscribe(d,2,function(b){clearTimeout(f);if("10"==b.payloadString){var c=_lang("explore_rdytoupdatehard");a.ui.showMask(c)}else{if("11"==b.payloadString)a.ui.hideMask(),
c=_lang("explore_downloadhardfailed");else{if("12"==b.payloadString){c=_lang("explore_downloadhardsucc");a.ui.showMask(c);return}if("13"==b.payloadString)a.ui.hideMask(),c=_lang("explore_writehardfailed");else{if("14"==b.payloadString){a.ui.hideMask();c=_lang("explore_writehardsucc");a.molmc.device.updataDevAndToken();navigator.notification.confirm(c,function(){a.ui.loadContent("#device",!1,!1,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"));return}if("20"==b.payloadString)c=_lang("explore_rdyupdatetoken"),
a.ui.showMask(c);else if("21"==b.payloadString)c=_lang("explore_updatetokenfailed"),a.ui.hideMask();else{if("22"==b.payloadString){c=_lang("explore_updatetokensucc");a.ui.hideMask();return}if("30"==b.payloadString){c=_lang("explore_rdyresetboad");a.ui.showMask(c);return}if("31"==b.payloadString)c=_lang("explore_resetfailed"),a.ui.hideMask();else if("32"==b.payloadString){a.ui.hideMask();c=_lang("explore_resetsucc");navigator.notification.confirm(c,function(){a.ui.loadContent("#device",!1,!1,"slide")},
_lang("tips_title_tips"),_lang("g_tips_confirm"));return}}}}navigator.notification.confirm(c,function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"))}},function(){a.ui.showMask(_lang("explore_downloadtoupdatehard"));var c=JSON.stringify(b);a.molmc.mainMqtt.publish(e,c,0,!1)});var f=setTimeout(function(){a.ui.hideMask();a.molmc.mainMqtt.unsubscribe(d);navigator.notification.confirm(_lang("explore_downloadfailed"),function(){},_lang("tips_title_tips"),_lang("g_tips_confirm"))},5E3)},B=function(f,
k){e=!0;var m="";""!==a("#input_search_explore").val()&&(m+="&fuzzy="+a("#input_search_explore").val());null!==c&&(f=1,c.innerText===_lang("explore_temperature")?m+="tag=thermometer":c.innerText===_lang("explore_switch")?m+="tag=switch":_lang("explore_limitless"));a.molmc.api.searchPubDevices(function(c){1==f||void 0==f?void 0===c.length?(b.Devicesshow=[],b.Devicesshow.unshift(p("","none"))):(b.Devicesshow=c,b.Devicesshow.unshift(p(_lang("explore_devlist"),"text"))):void 0===c.length?(d--,a.molmc.utils.showToast(_lang("explore_nomoredev"),
170,2E3)):b.Devicesshow=b.Devicesshow.concat(c);a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0})},m,f,k)};k.prototype={forkSubUrl:"v1/"+b.forkDevId+"/platform/default/info/notify",searchHotDevices:function(c,d){void 0===b.hotDevices|d?a.molmc.api.searchHotDevices(c):(b.Devicesshow=b.tempDevices.slice(0,b.tempDevices.length),a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0}))},searchNearbyDevices:function(c,d){void 0===b.nearDevices|
d?a.molmc.utils.getLocation(function(b){"object"==typeof b&&Object.prototype.isPrototypeOf(b)&&0!==Object.keys(b).length?a.molmc.api.searchPubDevices(c,"lat="+b.lat+"&lng="+b.lng+"&dist=50"):a.os.ios?(b=[_lang("g_btn_cancel"),_lang("g_btn_confirm")],navigator.notification.confirm(_lang("g_ios_getLocationErr"),function(b){2===b?a.os.ios&&settings.openLocationServicesSettings(function(b){a.ui.goBack()}):c("")},_lang("tips_title_tips"),b)):(b=[_lang("g_btn_cancel"),_lang("g_btn_confirm")],navigator.notification.confirm(_lang("g_getLocationErr"),
function(a){c("")},_lang("tips_title_tips"),b))}):(b.Devicesshow=b.tempDevices.slice(0,b.tempDevices.length),a.molmc.utils.showDevices(a("#pubDevList_explore"),b.Devicesshow,{flag_collect:!0}))},getPubdevInfo:function(c,d,e){f!==d?!1===b.isDemoDev?a.molmc.api.getPubDevice(c,d,e):a.molmc.api.getDeviceInfo(d,c):a.ui.loadContent("#widgets_explore",!1,!1,"slide")},getPubDevToken:function(b,c){a.molmc.api.getPubDevToken(b,c)},setIsDemo:function(a){b.isDemoDev=a},getDevices:function(c,d,e,h){b.isDemoDev=
void 0!==d?d:!1;d=function(c){f=c._id;b.CurDevice=c;a.ui.loadContent("#widgets_explore",!1,!1,"slide")};var k=function(c){b.CurToken=c;c={userName:b.CurToken.access_token,password:"password"};_.isEmpty(a.molmc.pubMqtt)?a.molmc.pubMqtt=new a.molmc.mqtt(c):a.molmc.pubMqtt.openConnect(c)},x=function(){navigator.notification.confirm(_lang("explore_deivce_private"),function(b){1===b&&a.molmc.device.deletecollectdevlist(h,e)},_lang("tips_title_tips"),_lang("g_btn_yes")+","+_lang("g_btn_no"))};a.molmc.utils.checkNetwork()&&
(!1===b.isDemoDev&&this.getPubDevToken(k,c),this.getPubdevInfo(d,c,x))},setcurdevices:function(a){b.CurDevice=a},setcurdevtoken:function(a){b.CurToken=a},pullUprefreshPage:function(a){l(a)}};a.molmc.explore=new k})(af);
(function(a){var b,f,c,d,e=!0,k,l=function(){var d=this;b=[];a(document).on("applogout",function(){c=f=b=void 0});a("#mapExplore").bind("loadpanel",function(){t();e&&(a("#myExploreMapDevices").scroller({verticalScroll:!0,horizontalScroll:!1,autoEnable:!0}),e=!1)});a("#mapExplore").bind("unloadpanel",function(){a(".backButton").show()});a("#myExploreMapDevices ul").on("tap","li",function(c){if(""!==c.currentTarget.id){a.molmc.device.getCollectDevs();c=b[c.currentTarget.id]._id;var e=function(b){a.molmc.explore.setcurdevices(b);
a.ui.loadContent("#widgets_explore",!1,!1,"slide")},k=function(b){f=b;a.molmc.explore.setcurdevtoken(b);b={userName:f.access_token,password:"password"};_.isEmpty(a.molmc.pubMqtt)?a.molmc.pubMqtt=new a.molmc.mqtt(b):a.molmc.pubMqtt.openConnect(b)};a.molmc.utils.checkNetwork()&&(d.getPubDevToken(k,c),d.getPubdevInfo(e,c))}})},n=function(b,d,e){void 0==e&&b.GetDistance();d=void 0==d?b.GetCenter():d;k={lng:d.lng,lat:d.lat,layer:b.getZoom()};a.molmc.api.searchPubDevices(function(d){_.isEmpty(d)?(a("#myExploreMapDevices ul").empty(),
a("#myExploreMapDevices ul").html("<div style='text-align:center;padding:10px 0px;font-size:18px;'>"+_lang("explore_map_nofounddev")+"</div>")):(c=d,b.clearOverlays(),b.markerClusterer(d),p(b))},"lng="+d.lng+"&lat="+d.lat+"&dist=300",1,400)},t=function(){a.molmc.utils.getLocation(function(b){"object"==typeof b&&Object.prototype.isPrototypeOf(b)&&0!==Object.keys(b).length||(navigator.notification.alert(_lang("\u5b9a\u4f4d\u5931\u8d25\uff0c\u6b63\u5728\u83b7\u53d6\u9ed8\u8ba4\u4f4d\u7f6e\u8bbe\u5907\u4fe1\u606f"),
function(){},_lang("tips_title_tips"),_lang("g_tips_confirm")),b={lng:116.331398,lat:39.897445});require(["vendor/map.quick"],function(c){_.isEmpty(k)?c.initMap("myExploreMap",{lng:b.lng,lat:b.lat,layer:5},{minZoom:4,maxZoom:16}):c.initMap("myExploreMap",k,{minZoom:4,maxZoom:16});"china"==a.molmc.position.localCountry.toLowerCase()?(c.listenTo("dragend",function(a){p(c)}),c.listenTo("zoomchange",function(a){p(c)}),n(c,k,.1),p(c)):c.listenToOnce("tilesloaded",function(a){c.listenTo("dragend",function(a){p(c)});
c.listenTo("zoom_changed",function(a){p(c)});n(c,k,.1);p(c)})})},!0)},p=function(d){var e=d.GetCenter(),f=d.GetRegion();k={lng:e.lng,lat:e.lat,layer:d.getZoom()};var l=[];void 0!==c&&c.forEach(function(a){var b=Math.abs(parseFloat(a.coordinate[0])-e.lng),c=Math.abs(parseFloat(a.coordinate[1])-e.lat);b<=f.horizontal&&c<=f.vertical&&l.push(a)});0==l.length?(a("#myExploreMapDevices ul").empty(),a("#myExploreMapDevices ul").html("<div style='text-align:center;padding:10px 0px;font-size:18px;'>"+_lang("explore_map_nofounddev")+
"</div>")):(a.molmc.utils.showDevices(a("#myExploreMapDevices ul"),l,{img:!1}),b=l)};l.prototype={getPubdevInfo:function(b,c){a.molmc.explore.setIsDemo(!1);d!==c?(d=c,a.molmc.api.getPubDevice(b,c)):a.ui.loadContent("#widgets_explore",!1,!1,"slide")},getPubDevToken:function(b,c){a.molmc.api.getPubDevToken(b,c)}};a.molmc.exploreMap=new l})(af);
(function(a){var b={curRecipe:{},editeRecipe:{}},f={_id:"000000000000000000000001",model:"system",company:"molmc",widgets:[{widget_id:9998,tab:0,duplicate:!0,ver:"1.0",widget_proto:"Date",type:"sysdate",name:_lang("graphic_time"),description:"sysdate",topics:[],triggerList:[{id:"010001",topicList:[]},{id:"010002",topicList:[]},{id:"010003",topicList:[]}]},{widget_id:9999,tab:0,duplicate:!0,ver:"1.0",widget_proto:"E-Mail",type:"sysmail",name:_lang("graphic_email"),description:"sysdate",topics:[],actionList:[{id:"010001",
topicList:[]}]}],uid:a.molmc.utils.getItem("uid"),name:_lang("graphic_system"),description:"description",dev_img:"assets/img/systemDev.png"},c=[],d=[],e,k,l,n,t,p,w,z,x=!1,A=function(){a(document).on("applogout",function(){b={curRecipe:{},editeRecipe:{}}});a("#graphic").bind("loadpanel",function(){a.molmc.device.isUtopicInDevPanel("none");y();a(".backButton").hide()});a("#graphic").bind("unloadpanel",function(){a(".backButton").show()});a("#graphic").on("tap","li>div",function(c){b.curRecipe=b.showCollection[c.currentTarget.parentElement.id];
e=J(b.curRecipe)[0];k=_.findWhere(e.widgets,{widget_id:J(b.curRecipe)[1]});l=I(b.curRecipe)[0];n=_.findWhere(l.widgets,{widget_id:I(b.curRecipe)[1]});if(_.isEmpty(k)|_.isEmpty(n)){var d=function(a){y(!0)};navigator.notification.confirm(_lang("graphic_nowidgets_err"),function(c){1===c&&("ScheduleTaskProducer"===b.curRecipe._cls?a.molmc.api.deleteSchedule(b.curRecipe._id,d):a.molmc.api.deleteRecipe(b.curRecipe._id,d))},_lang("g_btn_delete"),_lang("g_btn_yes")+","+_lang("g_btn_no"))}else{t=a.molmc.triggerEvent[b.curRecipe.factorID[0]];
for(c=0;c<k.triggerList.length;c++)k.triggerList[c].id==b.curRecipe.factorID[0]&&(w=c);p=a.molmc.actionEvent[b.curRecipe.factorID[1]];for(c=0;c<n.actionList.length;c++)n.actionList[c].id==b.curRecipe.factorID[1]&&(z=c);x=!1;a.ui.loadContent("#showRecicp_graphic",!1,!1,"slide")}});a("#graphic").on("longTap","li",function(c){var d=function(a){y(!0)};b.curRecipe={};b.curRecipe=b.showCollection[c.currentTarget.id];navigator.notification.vibrate(50);navigator.notification.confirm(_lang("graphic_deleterecipe_tips"),
function(c){1===c&&("ScheduleTaskProducer"===b.curRecipe._cls?a.molmc.api.deleteSchedule(b.curRecipe._id,d):a.molmc.api.deleteRecipe(b.curRecipe._id,d))},_lang("g_btn_delete"),_lang("g_btn_yes")+","+_lang("g_btn_no"))});a("#graphic").on("change","input",function(c){var d=b.showCollection[c.currentTarget.attributes[0].value];"0"==c.currentTarget.value?(c.currentTarget.value="1",a(c.currentTarget.parentElement).removeClass("gray-filter"),d.enabled=!0):"1"==c.currentTarget.value&&(c.currentTarget.value=
"0",a(c.currentTarget.parentElement).addClass("gray-filter"),d.enabled=!1);c=function(a){y(!0)};void 0===d.uid&&(d.uid=a.molmc.utils.getItem("uid"));"ScheduleTaskProducer"===d._cls?a.molmc.api.updateSchedule(d,c):a.molmc.api.updateRecipe(d,c)});a("#showRecicp_graphic").bind("loadpanel",function(){var c=I(b.curRecipe)[1],d=J(b.curRecipe)[1],d=fileSystemWidget+d+"/img/ThumbS.png",c=fileSystemWidget+c+"/img/ThumbS.png";a("#triggerimg_showRecipe").attr("src",d);a("#actionimg_showRecipe").attr("src",c);
a("#nameTile_graphic").html(b.curRecipe.description);C(t,a("#showRecicp_graphic #showtrigger_graphic"));K(p,a("#showRecicp_graphic #showaction_graphic"));x?"ScheduleTaskProducer"!==b.curRecipe._cls&"recycle"===p.category?(a("#recipeswitch_graphic").attr("checked","checked"),a("#recipeswitch_graphic").prop("checked",!0),a("#recipeswitch_graphic").val(1),a("#graphic_noticinfo_i").html(_lang("graphic_mode_recycleDec")),a("#trigger_mode_graphic").html(_lang("graphic_mode_recycle")),b.editeRecipe.category=
"recycle"):(a("#recipeswitch_graphic").removeAttr("checked","checked"),a("#recipeswitch_graphic").prop("checked",!1),a("#recipeswitch_graphic").val(0),a("#graphic_noticinfo_i").html(_lang("graphic_mode_edgeDec")),a("#trigger_mode_graphic").html(_lang("graphic_mode_edge")),b.editeRecipe.category="edge"):(b.editeRecipe=b.curRecipe,"recycle"===b.curRecipe.category?(a("#recipeswitch_graphic").attr("checked","checked"),a("#recipeswitch_graphic").prop("checked",!0),a("#recipeswitch_graphic").val(1),a("#graphic_noticinfo_i").html(_lang("graphic_mode_recycleDec")),
a("#trigger_mode_graphic").html(_lang("graphic_mode_recycle"))):"edge"===b.curRecipe.category&&(a("#recipeswitch_graphic").removeAttr("checked","checked"),a("#recipeswitch_graphic").prop("checked",!1),a("#recipeswitch_graphic").val(0),a("#graphic_noticinfo_i").html(_lang("graphic_mode_edgeDec")),a("#trigger_mode_graphic").html(_lang("graphic_mode_edge"))));"ScheduleTaskProducer"===b.curRecipe._cls|"E-Mail"===p.dataType?a("#recipeswitch_graphic").attr("disabled","disabled"):a("#recipeswitch_graphic").removeAttr("disabled",
"disabled")});a("#showRecicp_graphic").on("change","#recipeswitch_graphic",function(){1==a("#recipeswitch_graphic").val()?(a("#recipeswitch_graphic").removeAttr("checked","checked"),a("#recipeswitch_graphic").prop("checked",!1),a("#recipeswitch_graphic").val(0),a("#graphic_noticinfo_i").html(_lang("graphic_mode_edgeDec")),a("#trigger_mode_graphic").html(_lang("graphic_mode_edge")),b.editeRecipe.category="edge"):(a("#recipeswitch_graphic").attr("checked","checked"),a("#recipeswitch_graphic").prop("checked",
!0),a("#recipeswitch_graphic").val(1),a("#graphic_noticinfo_i").html(_lang("graphic_mode_recycleDec")),a("#trigger_mode_graphic").html(_lang("graphic_mode_recycle")),b.editeRecipe.category="recycle")});a("#showRecicp_graphic").on("change","select[name='setactionStatus']",function(){0==a("#showRecicp_graphic select[name='setactionStatus']").val()?a("#showRecicp_graphic tr[name='custom_value']").css("display","none"):a("#showRecicp_graphic tr[name='custom_value']").css("display","table-row")});a("#header_addgraphic").bind("tap",
function(){a.ui.loadContent("#createRecicp_graphic",!1,!1,"slide")});a("#createRecicp_graphic").bind("loadpanel",function(){d=[];d.push(f);d=d.concat(c);e=d[0];k=d[0].widgets[0];var b=a("#createRecicp_graphic .swiper-container-devlist .swiper-wrapper");B(d,"device","trigger",b);a("#devname_createRecicp").html(e.name);b=a("#createRecicp_graphic .swiper-container-widget .swiper-wrapper");B(e.widgets,"widget","trigger",b);a("#widname_createRecicp").html(k.name);h(k,a("#createRecicp_graphic .list"));
F("trigger","#createRecicp_graphic");m("trigger","#createRecicp_graphic")});a("#createRecicp_graphic .list").on("tap","i",function(c){w=c=c.currentTarget.attributes["data-triggerid"].value;t=a.molmc.triggerEvent[k.triggerList[c].id];b.editeRecipe.devices=[];b.editeRecipe.devices[0]=e._id;b.editeRecipe.factorID=[];b.editeRecipe.factorID[0]=k.triggerList[c].id;a.ui.loadContent("#settingtrigger_graphic",!1,!1,"slide")});a("#createaction_graphic").bind("loadpanel",function(){d=[];d.push(f);d=d.concat(c);
l=d[0];n=d[0].widgets[1];var b=a("#createaction_graphic .swiper-container-devlist .swiper-wrapper");B(d,"device","action",b);a("#devname_createAction").html(l.name);b=a("#createaction_graphic .swiper-container-widget .swiper-wrapper");B(l.widgets,"widget","action",b);a("#widname_createAction").html(n.name);v(n,a("#createaction_graphic .list"));F("action","#createaction_graphic");m("action","#createaction_graphic")});a("#createaction_graphic .list").on("tap","i",function(c){z=c=c.currentTarget.attributes["data-actionid"].value;
p=a.molmc.actionEvent[n.actionList[c].id];b.editeRecipe.devices[1]=l._id;b.editeRecipe.factorID[1]=n.actionList[c].id;a.ui.loadContent("#settingaction_graphic",!1,!1,"slide")});a("#settingtrigger_graphic").bind("loadpanel",function(){C(t,a("#settingtrigger_graphic .recipeinfobg"));a("#settingtrigger_graphic input[data-clear='true']").each(function(){a(this).val("")})});a("#settingtrigger_graphic").on("tap","#btn_settriggerconfirm",function(){!1!==q(t,"#settingtrigger_graphic .recipeinfobg")&&a.ui.loadContent("#createaction_graphic",
!1,!1,"slide")});a("#settingaction_graphic").bind("loadpanel",function(){K(p,a("#settingaction_graphic .recipeinfobg"));a("#settingaction_graphic textarea[data-clear='true']").each(function(){a(this).html("")});a("#settingaction_graphic input[data-clear='true']").each(function(){a(this).val("")})});a("#settingaction_graphic").on("tap","#btn_setactionconfirm",function(){!1!==G(p,"#settingaction_graphic .recipeinfobg")&&(b.curRecipe=b.editeRecipe,x=!0,a.ui.loadContent("#showRecicp_graphic",!1,!1,"slide"))});
a("#settingaction_graphic").on("change","select[name='setactionStatus']",function(){0==a("#settingaction_graphic select[name='setactionStatus']").val()?a("#settingaction_graphic tr[name='custom_value']").css("display","none"):a("#settingaction_graphic tr[name='custom_value']").css("display","table-row")});a("#header_showgraphic").on("tap","#save_recipe",function(){var c=function(c){x?a.molmc.utils.showToast(_lang("graphic_buildsucc"),180,2E3):a.molmc.utils.showToast(_lang("graphic_updatesucc"),180,
2E3);y(!0);a.ui.loadContent("#graphic",!1,!1,"slide");b.editeRecipe={}};if(!1!==q(t,"#showRecicp_graphic .recipeinfobg")&&!1!==G(p,"#showRecicp_graphic .recipeinfobg")){if("ScheduleTaskProducer"===b.editeRecipe._cls){var d=parseInt(b.editeRecipe.crontab.hour),d=d+parseInt((new Date).getTimezoneOffset())/60;0>d?d=24+d:23<d&&(d-=24);b.editeRecipe.crontab.hour=d+""}x?"ScheduleTaskProducer"===b.editeRecipe._cls?a.molmc.api.createSchedule(b.editeRecipe,c):a.molmc.api.createRecipe(b.editeRecipe,c):"ScheduleTaskProducer"===
b.curRecipe._cls?a.molmc.api.updateSchedule(b.editeRecipe,c):a.molmc.api.updateRecipe(b.editeRecipe,c)}})},y=function(d){c=a.molmc.device.deviceList();var g=function(c){b.recipes=c;void 0===b.schedules|!0===d&&a.molmc.api.getSchedules(e)},e=function(c){b.schedules=c;var d=a("#recipeList_graphic");if(void 0===c.length){if(void 0===b.recipes.length){a.molmc.utils.shownullDev(d,"graphic");return}b.showCollection=b.recipes.slice(0,b.recipes.length)}else b.showCollection=b.schedules.concat(b.recipes);
if(!_.isEmpty(d))if(c=b.showCollection,_.isEmpty(c))d.empty(),d.append('<div style="font-size: 1.5em;text-align: center;margin-top: 50%; color: darkgray; background: #F2F2F2;"><div><a href="#createRecicp_graphic" class="fa fa-plus-circle" style="font-size: 4em;color: darkgray;margin-bottom:20px;" id=""></a></div><span class="empty">\u8bf7\u70b9\u51fb\u6dfb\u52a0\u8054\u63a7</span></div>');else{var g=!1;d.empty();for(var e=0;e<c.length;e++)if("graphic"===c[e].type&&void 0!==I(c[e])){var g=!0,r="gray-filter",
f="",h=0;!0===c[e].enabled&&(r="",h=1,f='checked="checked"');var H=c[e].description,k=I(c[e])[1],m=J(c[e])[1],m=fileSystemWidget+m+"/img/ThumbS.png",k=fileSystemWidget+k+"/img/ThumbS.png",r='<li class="'+r+'" id="'+e+'" style="padding:5px 20px 5px 20px;"><input data-val="'+e+'" id="recipe_sw'+e+'" '+f+' type="checkbox" value="'+h+'" class="toggle floright"/><label style="left:auto;top:20px;" for="recipe_sw'+e+'" data-on='+_lang("g_on")+" data-off="+_lang("g_off")+' class="floright rectangle midtoggle" ><span class="rectangle"></span></label><div style="width:80%;"><img style="width:80px;height:80px;float:left;border-radius: 100%;" src='+
m+'><div style="float:left;height:80px;"><i class="fa fa-chevron-right" style="font-size:4em;margin-top:16px;color:#0088D1;"></i></div><img style="width:80px; height: 80px;border-radius: 100%;" src='+k+'></div><div class="desc-nowrap" style="color:#4D6B21;width: auto;text-align:center;word-break:break-all;" class="desc-nowrap">'+H+"</div></li>";d.append(r)}!1===g&&(d.empty(),d.append('<div style="font-size: 1.5em;text-align: center;margin-top: 50%; color: darkgray; background: #F2F2F2;"><div><a href="#createRecicp_graphic" class="fa fa-plus-circle" style="font-size: 4em;color: darkgray;margin-bottom:20px;" id=""></a></div><span class="empty">\u8bf7\u70b9\u51fb\u6dfb\u52a0\u8054\u63a7</span></div>'))}};
void 0===b.recipes|!0===d&&a.molmc.api.getRecipes(g)},B=function(a,b,c,d){var g,e;"device"===b?d.empty():"widget"===b&&d.empty();if(!_.isEmpty(a))for(var f=0;f<a.length;f++)if("device"===b?g=void 0===a[f].dev_img|""===a[f].dev_img?"img/intodunio.png":serverURL+"/"+a[f].dev_img:"widget"===b&&(g=fileSystemWidget+a[f].widget_id+"/img/ThumbS.png"),e="<div data-imgId="+f+' class="swiper-slide" style="background:url('+g+') no-repeat;background-size: contain;background-size:90% 90%"></div>',"device"===b){if(!_.isEmpty(a[f].widgets)){for(var h=
!1,k=0;k<a[f].widgets.length;k++)"trigger"===c?_.isEmpty(a[f].widgets[k].triggerList)||(h=!0):"action"===c&&(_.isEmpty(a[f].widgets[k].actionList)||(h=!0));h&&d.append(e)}}else"widget"===b&&("trigger"===c?_.isEmpty(a[f].triggerList)||d.append(e):"action"===c&&(_.isEmpty(a[f].actionList)||d.append(e)))},E,F=function(b,c){_.isEmpty(E)||E.destroy();var g=c+" .swiper-slide-active";E=new Swiper(c+" .swiper-container-devlist",{scrollbar:c+" .swiper-scrollbar-devlist",slidesPerView:"auto",effect:"coverflow",
initialSlide:0,scrollbarHide:!0,centeredSlides:!0,spaceBetween:10,grabCursor:!0,mousewheelControl:!0,coverflow:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},onTap:function(a,b){0<=a.clickedIndex&&a.slideTo(a.clickedIndex,200)},onTransitionEnd:function(c){c=c.wrapper.find(g);if(0<c.length)if(c=c[0].attributes["data-imgId"].value,"trigger"===b){e=d[c];for(c=0;c<e.widgets.length;c++)if(0<e.widgets[c].triggerList.length){k=e.widgets[c];break}a("#devname_createRecicp").html(e.name);c=a("#createRecicp_graphic .swiper-container-widget .swiper-wrapper");
B(e.widgets,"widget","trigger",c);a("#widname_createRecicp").html(k.name);m("trigger","#createRecicp_graphic");h(k,a("#createRecicp_graphic .list"))}else if("action"===b){l=d[c];a("#devname_createAction").html(l.name);c=a("#createaction_graphic .swiper-container-widget .swiper-wrapper");B(l.widgets,"widget","action",c);if("000000000000000000000001"===l._id)n=l.widgets[1];else for(c=0;c<l.widgets.length;c++)if(0<l.widgets[c].actionList.length){n=l.widgets[c];break}v(n,a("#createaction_graphic .list"));
m("action","#createaction_graphic");a("#widname_createAction").html(n.name)}}})},m=function(c,d){void 0!==b.mWidSwiper&&b.mWidSwiper.destroy();var g=d+" .swiper-slide-active";b.mWidSwiper=new Swiper(d+" .swiper-container-widget",{scrollbar:d+" .swiper-scrollbar-widget",slidesPerView:"auto",effect:"coverflow",initialSlide:0,scrollbarHide:!0,centeredSlides:!0,spaceBetween:10,grabCursor:!0,mousewheelControl:!0,coverflow:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},onTap:function(a,b){0<=a.clickedIndex&&
a.slideTo(a.clickedIndex,200)},onTransitionEnd:function(b){b=b.wrapper.find(g);0<b.length&&(b=b[0].attributes["data-imgId"].value,"trigger"===c?(k=e.widgets[b],a("#widname_createRecicp").html(k.name),h(k,a("#createRecicp_graphic .list"))):"action"===c&&(n=l.widgets[b],a("#widname_createAction").html(n.name),v(n,a("#createaction_graphic .list"))))}})},h=function(b,c){c.empty();for(var d=b.triggerList,g,e=0;e<d.length;e++)g="<li><table><tr><td><h3>"+a.molmc.triggerEvent[d[e].id].name+'</h3></td><td rowspan="2" class="addaction"><i  data-triggerId='+
e+' class="fa fa-plus-square"></i></td></tr><tr><td>'+a.molmc.triggerEvent[d[e].id].description+"</td></tr></table></li>",c.append(g)},v=function(b,c){c.empty();if(void 0!==b.actionList)for(var d=b.actionList,g,e=0;e<d.length;e++)g="<li><table><tr><td><h3>"+a.molmc.actionEvent[d[e].id].name+'</h3></td><td rowspan="2" class="addaction"><i  data-actionId='+e+' class="fa fa-plus-square"></i></td></tr><tr><td>'+a.molmc.actionEvent[d[e].id].description+"</td></tr></table></li>",c.append(g)},C=function(c,
d){if(!_.isEmpty(c)){d.empty();var f="",h="";if("Time"===c.dataType){if(!_.isEmpty(c.selectData)){for(h=0;h<c.selectData.length;h++){var m="";_.isEmpty(b.curRecipe.crontab)||("day_of_month"===c.selectType?h==parseInt(b.curRecipe.crontab[c.selectType])-1&&(m='selected="selected"'):h==b.curRecipe.crontab[c.selectType]&&(m='selected="selected"'));f=f+"<option "+m+" value="+h+">"+c.selectData[h]+"</option>"}f="<tr><td>"+_lang("graphic_trigger")+'</td><td style="text-align:right;"><select autofocus name="setTriggerTime" id="" style="width:inherit; background: lightgoldenrodyellow;">'+
f+"</select></td></tr>"}var q,l,n;_.isEmpty(b.curRecipe.crontab)||(n=parseInt(b.curRecipe.crontab.hour),!0!==x&&(n-=parseInt((new Date).getTimezoneOffset())/60,0>n?n=24+n:23<n&&(n-=24)),l="value="+u(n,2),q="value="+u(b.curRecipe.crontab.minute,2));!0!==isNaN(u(n,2))&&!0!==isNaN(u(b.curRecipe.crontab.minute,2))&&l&&q||(l=new Date,h="value="+u(l.getHours(),2),q="value="+u(l.getMinutes(),2),l=h);h="<tr><td>"+_lang("graphic_triggertime")+':</td><td style="text-align:right;width:60%" data-name="setTime"><input style="width:30%; background: lightgoldenrodyellow;" readonly="readonly" type="number" min="0" max="23"'+
l+' data-name="hour"/><span>'+_lang("graphic_hour")+'</span><input style="width:30%; background: lightgoldenrodyellow;" readonly="readonly" type="number" min="0" max="59" '+q+' data-name="minute"/><span>'+_lang("graphic_min")+"</span></td></tr>"}else if("Number"===c.dataType){for(h=0;h<c.exchange.length;h++)m="",_.isEmpty(b.curRecipe.exchange)||b.curRecipe.exchange==c.exchange[h]&&(m='selected="selected"'),f=f+"<option "+m+" value="+h+">"+c.selectData[h]+"</option>";f="<tr><td>"+_lang("graphic_logic")+
':</td><td style="text-align:right;"><select name="factorlogic" style="width:inherit; background: lightgoldenrodyellow;">'+f+"</select></td></tr>";h="";_.isEmpty(b.curRecipe.kwargs)||(h="value="+b.curRecipe.kwargs.threshold);h="<tr><td>"+_lang("graphic_threshold")+':</td><td style="text-align:right;width:50%"><input style="width:100%" data-clear="true"  background: lightgoldenrodyellow;" type="number" data-name="factorVal-graphic" '+h+" /></td></tr>"}else"Bool"===c.dataType&&(l=f="",_.isEmpty(b.curRecipe.kwargs)||
(1==b.curRecipe.kwargs.threshold?f='selected="selected"':l='selected="selected"'),f="<option "+f+' value="1">'+_lang("g_on")+"</option><option "+l+' value="0">'+_lang("g_off")+"</option>",f="<tr><td>"+_lang("graphic_choosesta")+':</td><td style="text-align:right;"><select name="setTriggerStatus" id="" style="width:inherit; background: lightgoldenrodyellow;">'+f+"</select></td></tr>");l="";_.isEmpty(k.topics)||(l=k.triggerList[w].topicList[0],l="<tr><td>"+_lang("graphic_sensors")+':</td><td style="text-align:right;">'+
k.topics[l].name+"</td></tr>");f='<table cellspacing="10" style="width:100%;"><tr style="text-align:center;"><td colspan="3"><h3>'+_lang("graphic_trigger")+"</h3></td></tr><tr><td>"+_lang("device_devname")+':</td><td style="text-align:right;">'+e.name+"</td></tr><tr><td>"+_lang("device_setwidget_name")+':</td><td style="text-align:right;">'+k.name+"</td></tr>"+l+f+h+"</table>";d.append(f);"Time"===c.dataType&&a("td[data-name='setTime']").bind("tap",function(a){g()})}},u=function(a,b){return(""+a).length<
b?(Array(b+1).join("0")+a).slice(-b):""+a},g=function(){datePicker.show({date:new Date,mode:"time"},function(b){b=b.toString().split(" ")[4].match(/(\w+):(\w+)/);a("input[data-name='hour']").val(b[1]);a("input[data-name='minute']").val(b[2])},function(a){})},q=function(c,d){b.editeRecipe._cls=c._cls;b.editeRecipe.task=c.task;b.editeRecipe.type="graphic";b.editeRecipe.uid=a.molmc.utils.getItem("uid");b.editeRecipe.run_immediately=!1;b.editeRecipe.kwargs={};b.editeRecipe.enabled=!0;if("000000000000000000000001"===
e._id)b.editeRecipe.description=c.name,b.editeRecipe.crontab={_cls:"Crontab",minute:"*",hour:"*",day_of_week:"*",day_of_month:"*",month_of_year:"*"};else{b.editeRecipe.description=_lang("graphic_dev")+e.name+_lang("graphic_s")+c.name;b.editeRecipe.crontab={_cls:"Crontab"};var g=k.triggerList[w].topicList[0];b.editeRecipe.routing_key="v1/"+e._id+k.topics[g].url}if("Time"===c.dataType){var f=d+' select[name="setTriggerTime"]',h=d+' input[data-name="hour"]',m=d+' input[data-name="minute"]';0<a(f).length&&
(b.editeRecipe.crontab[c.selectType]="day_of_month"===c.selectType?(parseInt(a(f).val())+1).toString():a(f).val(),b.editeRecipe.description+=c.selectData[a(f).val()]);f=a(h).val();g=a(m).val();if(23<f|0>f|0>g|60<g)return navigator.notification.alert(_lang("graphic_settimeerr"),"",_lang("tips_title_tips"),_lang("g_tips_confirm")),!1;b.editeRecipe.crontab.hour=f;b.editeRecipe.crontab.minute=g;b.editeRecipe.routing_key=c.routing_key;b.editeRecipe.exchange=c.exchange;b.editeRecipe.description=b.editeRecipe.description+
_lang("graphic_at")+u(f,2)+":"+u(g,2)}else if("Number"===c.dataType){f=d+' select[name="factorlogic"]';m=d+' input[data-name="factorVal-graphic"]';h=a(m).val();g=k.triggerList[w].topicList[0];if(void 0!==k.topics[g].attribute.max){var q=parseFloat(k.topics[g].attribute.max);if(parseFloat(h)>q)return navigator.notification.alert(_lang("graphic_maxerr"),"",_lang("tips_title_tips"),_lang("g_tips_confirm")),!1}if(void 0!==k.topics[g].attribute.max&&(g=parseFloat(k.topics[g].attribute.min),parseFloat(h)<
g))return navigator.notification.alert(_lang("graphic_minerr"),"",_lang("tips_title_tips"),_lang("g_tips_confirm")),!1;b.editeRecipe.kwargs.threshold=a(m).val();b.editeRecipe.exchange=c.exchange[a(f).val()];b.editeRecipe.description=b.editeRecipe.description+c.selectData[a(f).val()]+a(m).val()}else"Bool"===c.dataType&&(f=d+' select[name="setTriggerStatus"]',b.editeRecipe.kwargs.threshold=a(f).val(),b.editeRecipe.exchange=c.exchange,b.editeRecipe.description=b.editeRecipe.description+_lang("graphic_is")+
c.selectData[parseInt(a(f).val())])},K=function(c,d){if(!_.isEmpty(c)){d.empty();var g="",e="";if("E-Mail"===c.dataType)g=a.molmc.utils.getItem("account"),a.molmc.utils.checkEmail(g)||navigator.notification.alert(_lang("graphic_not_email"),function(){a.ui.loadContent("#graphic",!1,!0,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm")),g=_.isEmpty(b.curRecipe.args)?"":b.curRecipe.args[2],g="<tr><td>"+_lang("graphic_sendemail")+':</td></tr><tr><td colspan="2"><input type="email" name="email" style="background:transparent;" value="'+
a.molmc.utils.getItem("email")+'" readonly="readonly"/></td></tr><tr><td>'+_lang("graphic_sendecontent")+'</td></tr><tr><td colspan="2"><textarea type="text" data-clear="true" name="mailcontent" style="background: lightgoldenrodyellow;" rows="2" placeholder="'+_lang("graphic_inputcontent")+'">'+g+"</textarea></td></tr>";else if("String"===c.dataType)g=_.isEmpty(b.curRecipe.args)?"":b.curRecipe.args[2],g="<tr><td>"+_lang("graphic_trigger")+':</td></tr><tr><td colspan="2"><textarea type="text" data-clear="true" name="stringcontent" style="background: lightgoldenrodyellow;" rows="2" placeholder="'+
_lang("graphic_inputcontent")+'">'+g+"</textarea></td></tr>";else if("Message"===c.dataType)g=_.isEmpty(b.curRecipe.args)?"":b.curRecipe.args[2],g="<tr><td>"+_lang("graphic_sendecontent")+':</td></tr><tr><td colspan="2"><textarea type="text" data-clear="true" name="message" style="background: lightgoldenrodyellow;" rows="2" placeholder="'+_lang("graphic_inputcontent")+'">'+g+"</textarea></td></tr>";else if("Bool"===c.dataType){var f="",h="";_.isEmpty(b.curRecipe.args)||(1==b.curRecipe.args[2]?f='selected="selected"':
h='selected="selected"');g="<tr><td>"+_lang("graphic_trigger")+':</td><td style="text-align:right;"><select name="setactionStatus" id="" style="width:inherit; background: lightgoldenrodyellow;"><option '+f+' value="1">'+_lang("g_on")+"</option><option "+h+' value="0">'+_lang("g_off")+"</option></select></td></tr>"}else if("Number"===c.dataType)g="",_.isEmpty(b.curRecipe.args)||(g="value="+b.curRecipe.args[2]),f=n.actionList[z].topicList[0],f=n.topics[f].attribute.unit,void 0==f&&(f=""),g="<tr><td>"+
_lang("graphic_action_setNumTitle")+':</td><td style="text-align:right;width:50%;line-height:45px;"><input style="width:70%;float:left;" data-clear="true" type="number" data-name="factorVal-graphic" '+g+" /><span>"+f+"</span></td></tr>";else if("Custom"===c.dataType)if("sprinkler"===c.CustomType){g=h=f="";_.isEmpty(b.curRecipe.args)||(1==JSON.parse(b.curRecipe.args[2]).status?f='selected="selected"':(h='selected="selected"',g="none"));for(var f="<tr><td>"+_lang("graphic_trigger")+':</td><td style="text-align:right;"><select name="setactionStatus" id="" style="width:inherit; background: lightgoldenrodyellow;"><option '+
f+' value="1">'+_lang("g_on")+"</option><option "+h+' value="0">'+_lang("g_off")+"</option></select></td></tr>",m=h="",k=0;k<c.selectTime.length;k++)m="",_.isEmpty(b.curRecipe.args)||c.selectTime[k]==JSON.parse(b.curRecipe.args[2]).time&&(m='selected="selected"'),h=0==c.selectTime[k]?h+"<option "+m+" value="+c.selectTime[k]+">"+_lang("widgetlist_12_forever")+"</option>":h+"<option "+m+" value="+c.selectTime[k]+">"+c.selectTime[k]+_lang("widgetlist_12_minute")+"</option>";g='<tr name="custom_value" style="display:'+
g+';"><td>'+_lang("widgetlist_12_timerDes")+':</td><td style="text-align:right;"><select autofocus name="setactionTime" id="" style="width:inherit; background: lightgoldenrodyellow;">'+h+"</select><span></span></td></tr>";g=f+g}else"aircondition"===c.CustomType?(g=h=f="",_.isEmpty(b.curRecipe.args)||("1"==JSON.parse(b.curRecipe.args[2])["switch"]?f='selected="selected"':(h='selected="selected"',g="none")),f="<tr><td>"+_lang("widgetlist_30_switch")+':</td><td style="text-align:right;"><select name="setactionStatus" id="" style="width:inherit; background: lightgoldenrodyellow;"><option '+
f+' value="1">'+_lang("g_on")+"</option><option "+h+' value="0">'+_lang("g_off")+"</option></select></td></tr>",h=27,_.isEmpty(b.curRecipe.args)||(h=JSON.parse(b.curRecipe.args[2]).temp),g='<tr name="custom_value" style="display:'+g+';"><td>'+_lang("action_050002_temp")+':</td><td style="text-align:right;"><input name="inputTemp" type="number" data-clear="true" value='+h+' style="width:50px; background: lightgoldenrodyellow;"><span style="font-size:1.3em;">\u2103</span></td></tr>',g=f+g):"petfeed"===
c.CustomType&&(f=g="",_.isEmpty(b.curRecipe.args)||("1"==JSON.parse(b.curRecipe.args[2]).feed?g='selected="selected"':f='selected="selected"'),g="<tr><td>"+_lang("widgetlist_51_feed_switch")+':</td><td style="text-align:right;"><select name="setactionfeedStatus" id="" style="width:inherit;"><option '+g+' value="1">'+_lang("g_on")+"</option><option "+f+' value="0">'+_lang("g_off")+"</option></select></td></tr>",h=f="",_.isEmpty(b.curRecipe.args)||("1"==JSON.parse(b.curRecipe.args[2]).photo?f='selected="selected"':
h='selected="selected"'),f="<tr><td>"+_lang("widgetlist_51_photo_switch")+':</td><td style="text-align:right;"><select name="setactionphotoStatus" id="" style="width:inherit;"><option '+f+' value="1">'+_lang("g_on")+"</option><option "+h+' value="0">'+_lang("g_off")+"</option></select></td></tr>",g+=f);_.isEmpty(n.topics)||(f=n.actionList[z].topicList[0],e="<tr><td>"+_lang("graphic_sensors")+':</td><td style="text-align:right;">'+n.topics[f].name+"</td></tr>");e='<table cellspacing="10" style="width:100%;"><tr style="text-align:center;"><td colspan="3"><h3>'+
_lang("graphic_action")+"</h3></td></tr><tr><td>"+_lang("device_devname")+':</td><td style="text-align:right;">'+l.name+"</td></tr><tr><td>"+_lang("device_setwidget_name")+':</td><td style="text-align:right;">'+n.name+"</td></tr>"+e+g+"</table>";d.append(e)}},G=function(c,d){var g="",e=[],g="000000000000000000000001"===l._id?c.name:_lang("graphic_dev")+l.name+_lang("graphic_s")+c.name;if("E-Mail"===c.dataType){var f=d+' input[name="email"]',h=a(d+' textarea[name="mailcontent"]').val();a(k).blur();
if(0===h.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(!a.molmc.utils.checkInput(h))return navigator.notification.confirm(_lang("device_notice_content"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;e[0]="email";e[1]=a(f).val();e[2]=h;g+=a(f).val()}else if("Message"===c.dataType){var k=d+' textarea[name="message"]',h=a(k).val();a(k).blur();if(0===h.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),
function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;if(!a.molmc.utils.checkInput(h))return navigator.notification.confirm(_lang("device_notice_content"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;e[0]="mqtt";e[1]="v1/"+l._id+"/firmware/default/info/message";e[2]=h;g=g+h+_lang("graphic_toyou")}else if("Bool"===c.dataType)h=d+' select[name="setactionStatus"]',f=n.actionList[z].topicList[0],e[0]="mqtt",e[1]="v1/"+l._id+n.topics[f].url,e[2]=a(h).val(),g+=c.selectData[parseInt(a(h).val())];
else if("Number"===c.dataType)f=n.actionList[z].topicList[0],e[0]="mqtt",e[1]="v1/"+l._id+n.topics[f].url,e[2]=a(d+' input[data-name="factorVal-graphic"]').val(),f=n.actionList[z].topicList[0],f=n.topics[f].attribute.unit,void 0==f&&(f=""),g=g+_lang("graphic_action_setNumTitle")+e[2]+f;else if("String"===c.dataType){f=n.actionList[z].topicList[0];h=a(d+' textarea[name="stringcontent"]').val();if(0===h.length)return navigator.notification.confirm(_lang("g_error_cannotempty"),function(){},_lang("g_tips_error"),
_lang("g_tips_confirm")),!1;if(!a.molmc.utils.checkInput(h))return navigator.notification.confirm(_lang("device_notice_content"),function(){},_lang("g_tips_error"),_lang("g_tips_confirm")),!1;e[0]="mqtt";e[1]="v1/"+l._id+n.topics[f].url;e[2]=h;g+=h}else"Custom"===c.dataType&&(f=n.actionList[z].topicList[0],"sprinkler"===c.CustomType?(h=d+' select[name="setactionTime"]',h={status:parseInt(a(d+' select[name="setactionStatus"]').val()),time:parseInt(a(h).val())},e[0]="mqtt",e[1]="v1/"+l._id+n.topics[f].url,
e[2]=JSON.stringify(h)):"aircondition"===c.CustomType?(h=d+' input[name="inputTemp"]',h={mode:0,"switch":parseInt(a(d+' select[name="setactionStatus"]').val()),temp:parseInt(a(h).val())},e[0]="mqtt",e[1]="v1/"+l._id+n.topics[f].url,e[2]=JSON.stringify(h)):"petfeed"===c.CustomType&&(h=d+' select[name="setactionphotoStatus"]',h={feed:parseInt(a(d+' select[name="setactionfeedStatus"]').val()),photo:parseInt(a(h).val())},e[0]="mqtt",e[1]="v1/"+l._id+n.topics[f].url,e[2]=JSON.stringify(h)));b.editeRecipe.description=
_lang("graphic_if")+" "+b.editeRecipe.description+","+_lang("graphic_then")+" "+g;b.editeRecipe.args=e},J=function(b){if(!_.isEmpty(b.factorID)){var d;if("Time"===a.molmc.triggerEvent[b.factorID[0]].dataType)b=f,d=9998;else{var g=b.routing_key;b=/^v1\/([\w]+)\//g.exec(g)[1];g=/^v1\/[\w]+\/channel\/([\w]+)\//g.exec(g)[1].split("_");c=a.molmc.device.deviceList();if(b=_.findWhere(c,{_id:b})){var e=b.widgets;e&&(g=_.findWhere(e,{widget_proto:g[0],tab:parseInt(g[1])}))&&(d=g.widget_id)}}return[b,d]}},
I=function(b){var c;if(!_.isEmpty(b.factorID)){var d=a.molmc.actionEvent[b.factorID[1]],g;"E-Mail"===d.dataType?(c=f,g=9999):"Message"===d.dataType?(c=f,g=9997):void 0!==b.args&&!_.isEmpty(b.args[1])&&(b=b.args[1],c=/^v1\/([\w]+)\//g.exec(b)[1],b=/^v1\/[\w]+\/channel\/([\w]+)\//g.exec(b)[1].split("_"),d=a.molmc.device.deviceList(),c=_.findWhere(d,{_id:c}))&&(d=c.widgets)&&(b=_.findWhere(d,{widget_proto:b[0],tab:parseInt(b[1])}))&&(g=b.widget_id);return[c,g]}};A.prototype={GetRecipes:function(c,d){void 0===
b.recipes|!0===d&&a.molmc.api.getRecipes(c)},GetSchedules:function(c,d){void 0===b.schedules|!0===d&&a.molmc.api.getSchedules(c)},ShowRecipeList:function(a){y(a)}};a.molmc.grapic=new A})(af);
(function(a){var b=function(){},f={50101:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50102:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50103:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50104:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50105:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50106:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50201:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",
50202:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50203:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50204:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50205:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50206:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50207:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50208:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50209:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",
50301:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50302:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50303:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50304:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50305:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50306:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50307:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50308:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",
50309:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50310:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50311:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50312:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50313:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50314:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50315:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50316:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",
50317:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50318:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50319:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50320:"\u670d\u52a1\u5668\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",50321:"lua\u6a21\u5757\u521d\u59cb\u5316\u5931\u8d25",50322:"lua\u6a21\u5757\u8fde\u63a5\u670d\u52a1\u5668\u5931\u8d25",40001:"\u9519\u8bef\u8c03\u7528",40002:"\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u67e5\u8be2\u518d\u8bd5",40003:"\u4e0d\u5141\u8bb8\u8bbf\u95ee\u8be5\u8d44\u6e90",
40004:"\u8d44\u6e90\u672a\u627e\u5230\uff0c\u8bf7\u67e5\u8be2\u540e\u518d\u8bd5",40005:"\u6570\u636e\u9519\u8bef",40006:"\u8d26\u6237\u4e0d\u5339\u914d",40007:"\u8bbe\u5907\u4e0d\u5339\u914d",40008:"id\u4e0d\u5408\u6cd5",40009:"\u7f3a\u5c11id",40010:"\u9a8c\u8bc1\u7801\u672a\u627e\u5230",40011:"\u9a8c\u8bc1\u7801\u9519\u8bef",40012:"\u6570\u636e\u7c7b\u578b\u9519\u8bef",40013:"\u957f\u5ea6\u9519\u8bef",40014:"\u95f4\u9694\u9519\u8bef",40015:"\u7f13\u5b58\u8fc7\u671f",40016:"\u9a8c\u8bc1\u7801\u8fc7\u671f",
40017:"\u5df2\u7ecf\u5b58\u5728",40018:"\u540d\u79f0\u91cd\u590d",40019:"\u8bbe\u5907\u6570\u91cf\u9650\u5236",40020:"\u8bf7\u91cd\u8bd5",40021:"\u8bf7\u6c42\u592a\u9891\u7e41",40022:"name\u4e0d\u5408\u6cd5",40023:"zone\u4e0d\u5408\u6cd5",40024:"\u77ed\u4fe1\u9a8c\u8bc1\u7801\u6570\u91cf\u9650\u5236",40101:"\u7528\u6237\u672a\u6ce8\u518c",40102:"\u7528\u6237\u672a\u6fc0\u6d3b",40103:"\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef",40104:"\u7f3a\u5c11stateID",40105:"state\u7801\u9519\u8bef",40106:"openid\u5df2\u7ed1\u5b9a",
40107:"\u5e10\u53f7\u5df2\u7ed1\u5b9a",40108:"\u7528\u6237\u540d\u5df2\u5b58\u5728",40109:"\u90ae\u7bb1\u5df2\u6ce8\u518c",40110:"\u624b\u673a\u53f7\u5df2\u6ce8\u518c",40111:"\u9700\u8981\u91cd\u767b\u9646",40112:"\u7528\u6237\u540d\u4e0d\u5408\u6cd5",40113:"\u5df2\u5173\u6ce8\u8be5\u7528\u6237",40114:"\u6fc0\u6d3b\u7801\u8fc7\u671f",40115:"\u8d26\u6237\u5df2\u88ab\u51bb\u7ed3",40116:"\u8bf7\u6c42\u77ed\u4fe1\u9a8c\u8bc1\u7801\u592a\u9891\u7e41",40117:"\u6ce8\u518c\u592a\u9891\u7e41",40118:"\u5fd8\u8bb0\u5bc6\u7801\u592a\u9891\u7e41",
40201:"\u8bbe\u5907\u5750\u6807\u53c2\u6570\u9519\u8bef",40202:"\u8bbe\u5907\u7eac\u5ea6\u53c2\u6570\u9519\u8bef",40203:"\u8bbe\u5907\u7ecf\u5ea6\u53c2\u6570\u9519\u8bef",40301:"token\u4e0d\u5141\u8bb8\u79c1\u6709",40401:"\u79c1\u6709\u5e93\u7f3a\u5c11\u793a\u4f8b",40402:"\u79c1\u6709\u5e93\u7f3a\u5c11md5\u7801",40403:"\u79c1\u6709\u5e93\u672a\u901a\u8fc7\u6821\u9a8c",40404:"\u79c1\u6709\u5e93\u7248\u672c\u53f7\u9519\u8bef",40405:"\u793a\u4f8b\u4f9d\u8d56\u79c1\u6709\u5e93",40406:"\u79c1\u6709\u5e93\u7f3a\u5c11\u540c\u540d\u5934\u6587\u4ef6",
40407:"\u79c1\u6709\u5e93\u7f3a\u5c11\u540c\u540d\u6e90\u6587\u4ef6",40408:"\u79c1\u6709\u5e93\u8fd8\u672a\u901a\u8fc7\u6821\u9a8c",40409:"\u79c1\u6709\u5e93\u4f9d\u8d56\u79c1\u6709\u5e93",40501:"\u8bed\u6cd5\u9519\u8bef",40502:"\u79c1\u6709\u5e93\u4e0d\u5b58\u5728",40503:"\u516c\u5171\u5e93\u4e0d\u5b58\u5728"},c={50101:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50102:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50103:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50104:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",
50105:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50106:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50201:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50202:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50203:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50204:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50205:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50206:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50207:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",
50208:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50209:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50301:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50302:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50303:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50304:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50305:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50306:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50307:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",
50308:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50309:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50310:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50311:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50312:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50313:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50314:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50315:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50316:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",
50317:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50318:"SORRY, SOMETHING WRONG WHEN CONNECT TO THIRD-PARTY SERVER.",50319:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50320:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",50321:"SORRY, SERVER IS BUSY. TRY AGAGIN LATER PLEASE.",40001:"method not implemented.",40002:"parameters not correct, check again please.",40003:"resource you request is not allowed.",40004:"resource not found, check you params please.",40005:"payload invalid, check again please.",
40006:"user id not match. you must be the owner.",40007:"device id not match. check again please.",40008:"not a validate id.",40009:"id missing.",40010:"verify id not found.",40011:"validate code not correct.",40012:"Content-Type not correct.",40013:"size must be number.",40014:"unknow interval value.",40015:"cache expired.",40016:"validate code expired.",40017:"already exists. should be enough.",40018:"name or title already used.",40019:"can't create any more devices. please upgrade.",40020:"sorry, we are little dizzy. try again please.",
40021:"request too quickly, please wait a moment.",40022:"invalidat name, please check again.",40023:"zone not available, please try email instead.",40024:"can't send any more sms messages today.",40101:"user not register.",40102:"user not activated.",40103:"username or password not correct.",40104:"state id not found",40105:"state code not correct.",40106:"openid has already binded.",40107:"email has already binded.",40108:"username has already existed.",40109:"email has already registered.",40110:"phone has already registered.",
40111:"please login first.",40112:"invalidate email address or phone number.",40113:"don't panic, already followed.",40114:"registeration obselete. please start over.",40115:"your account is abnormal and has been freezed.",40116:"request sms vldCode too quickly.",40117:"register too quickly, please wait a moment.",40118:"forgetpw too quickly, please wait a moment.",40201:"coordinate must be number.",40202:"latitude must in [-90, 90]",40203:"longtitude must in [-180, 180]",40301:"token must be public.",
40401:"userlib has no example.",40402:"each example must have md5 signature.",40403:"userlib not pass validation.",40404:"version must be increasing.",40405:"dependence of userlib example not correct.",40406:"must contain a header file, same name with lib.",40407:"must contain a source file, same name with lib",40408:"userlib must validate first.",40409:"dependence of userlib not correct.",40501:"syntax error, check your code please.",40502:"userlib does not exist.",40503:"publib does not exist."},
d=function(b){b="zh"==currentBrowserLanguage?f[b]:"en"==currentBrowserLanguage?c[b]:"zht"==currentBrowserLanguage?Traditionalized(f[b]):void 0;a.molmc.utils.showToast(b,200,2E3)};b.prototype={responseErr:function(b,c){"40111"==b?navigator.notification.confirm(_lang("g_error_relog"),function(b){a.molmc.utils.setItem("autoLogin",!1);a.ui.loadContent("#login",!1,!1,"slide")},_lang("g_tips_error"),_lang("g_tips_confirm")):d(b)}};a.molmc.httpStatus=new b})(af);
(function(a){var b={},f,c,d,e,k=function(){};a("#ios_deviceconfig").bind("loadpanel",function(){a(".backButton").show();a("#smartConfig").html(_lang("\u914d\u7f6eneutron"));a("#smartConfig").css("font-size","14px");a("#ios_devssidList input[name='devSsid']").val("");a("#ios_wifissidList input[name='wifiSsid']").val("");a("#ios_deviceconfig input[name='wifipwd']").val("");clearInterval(void 0);clearInterval(e);!0===a.molmc.device.isCreateDev()?a("#header_configstep2_device h1").html(_lang("device_adddevice")):
a("#header_configstep2_device h1").html(_lang("device_bind"));a.molmc.utils.getLocation(function(c){"object"==typeof c&&Object.prototype.isPrototypeOf(c)&&0!==Object.keys(c).length?(b.point=c,require(["vendor/map.quick"],function(a){a.initMap("myExploreMap",{lng:c.lng,lat:c.lat,layer:5},{minZoom:4,maxZoom:16});a.LocalByPoint(c,function(a){b.city=a})})):navigator.notification.confirm("\u624b\u673a\u5b9a\u4f4d\u670d\u52a1\u5df2\u5173\u95ed\uff0c\u8bf7\u6309[\u786e\u8ba4]\u952e\u8fdb\u5165\u7cfb\u7edf[\u8bbe\u7f6e]-[\u9690\u79c1]-[\u5b9a\u4f4d\u670d\u52a1]\u6253\u5f00\u5b9a\u4f4d\u670d\u52a1\uff0c\u5426\u5219\u6309[\u53d6\u6d88]\u952e\uff0c\u4f46\u53ef\u80fd\u5bfc\u81f4\u6dfb\u52a0\u7684\u8bbe\u5907\u6240\u5728\u4f4d\u7f6e\u4e0d\u662f\u60a8\u7684\u5f53\u524d\u4f4d\u7f6e",
function(d){2===d&&a.os.ios&&settings.openLocationServicesSettings(function(b){a.ui.goBack()});c={lng:116.331398,lat:39.897445};b.point=c;b.city="\u5317\u4eac\u5e02";require(["vendor/map.quick"],function(a){a.initMap("myExploreMap",{lng:c.lng,lat:c.lat,layer:5},{minZoom:4,maxZoom:16});a.LocalByPoint(c,function(a){b.city=a})})},"\u63d0\u793a",["\u53d6\u6d88","\u786e\u8ba4"])});WifiWizard.getCurrentSSID(function(b){a.ui.hideMask();a("#ios_wifissidList input[name='wifiSsid']").val(b);navigator.notification.confirm('\u7531\u4e8eIOS\u7cfb\u7edfWi-Fi API\u9650\u5236\u7684\u539f\u56e0\uff0c\u914d\u7f6eAtom\u5728IOS\u8bbe\u5907\u4e0a\u7684\u4f53\u9a8c\u6b20\u4f73\uff0c\u5f3a\u70c8\u5efa\u8bae\u60a8\u4f7f\u7528Android\u8bbe\u5907\u8fdb\u884c[\u6dfb\u52a0\u8bbe\u5907]\uff0c\u82e5\u8981\u7ee7\u7eed\u8bf7\u70b9\u51fb[\u786e\u8ba4]\u540e\u8fdb\u5165\u7cfb\u7edf"\u8bbe\u7f6e"\uff0d\u201c\u65e0\u7ebf\u5c40\u57df\u7f51\u201d\u754c\u9762\u9009\u62e9\u9700\u8981\u7ed1\u5b9a\u7684IntoRobot\u8bbe\u5907wifi\uff0c\u5426\u5219\u6309[\u53d6\u6d88]\u540e\u4f7f\u7528Android\u8bbe\u5907\u8fdb\u884c\u6b64\u64cd\u4f5c\u6216\u8fdb\u5165\u914d\u7f6eneutron\u8bbe\u5907\u3002',
function(a){2===a&&settings.openWifiSettings(function(a){})},"\u63d0\u793a",["\u53d6\u6d88","\u786e\u8ba4"])},function(b){a.ui.hideMask()});a.ui.showMask("waitting")});a("#ios_deviceconfig").bind("unloadpanel",function(){clearInterval(void 0);clearInterval(e);l()});a("#ios_devssidList").on("tap","input[name='devSsid']",function(){WifiWizard.getCurrentSSID(function(b){a.ui.hideMask();-1!==b.toLowerCase().indexOf("intorobot")?a("#ios_devssidList input[name='devSsid']").val(b):navigator.notification.confirm("\u8bf7\u786e\u5b9a\u662f\u5426\u8fde\u63a5\u4e0aIntoRobot\u8bbe\u5907wifi",
function(a){2===a&&settings.openWifiSettings(function(a){})},"\u63d0\u793a",["\u53d6\u6d88","\u786e\u8ba4"])},function(b){a.ui.hideMask()})});a("#ios_wifissidList").on("tap","input[name='wifiSsid']",function(){});a("#ios_deviceconfig").on("tap",".button",function(){var c=a("#ios_devssidList input[name='devSsid']").val(),e=a("#ios_wifissidList input[name='wifiSsid']").val(),f=a("#ios_deviceconfig input[name='wifipwd']").val();d={devssid:c,wifissid:e,wifipwd:f};var f=function(e){null===a.molmc.utils.getItem("count")&&
a.molmc.utils.setItem("count",1);var f=a.molmc.utils.getItem("count"),k={uid:a.molmc.utils.getItem("uid"),name:c+"_"+f,isPublic:!0,tags:"atom",dev_img:"assets/img/intodunio.png",shareType:1,product_id:e,city:b.city,coordinate:[b.point.lng,b.point.lat],description:c+"_"+f};e=function(c){clearInterval(void 0);t(c,function(c){a.molmc.mainMqtt.disconnect();z(b.Tokens);p();a.molmc.device.updataDevAndToken();a.ui.hideMask();f=parseInt(f)+1;a.molmc.utils.setItem("count",f);!0!==a.molmc.device.isCreateDev()&&
(c="\u7ed1\u5b9a\u8bbe\u5907"+d.devssid+"\u6210\u529f\uff01\r\u6ce8\u610f:\u60a8\u7684\u624b\u673a\u76ee\u524d\u94fe\u63a5\u7684\u662fIntoRobot\u8bbe\u5907Wi-Fi\uff0c\u82e5\u60a8\u7684IntoRbot\u8bbe\u5907\u4e0d\u80fd\u8fde\u63a5\u5230\u4e92\u8054\u7f51\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f60\u7684\u624b\u673a\u4e0d\u80fd\u4e0a\u7f51\uff0c\u8bf7\u786e\u4fdd\u60a8\u7ed9\u8bbe\u5907\u914d\u7f6e\u7684\u7f51\u7edcWi-Fi\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\u3002");navigator.notification.confirm(c,function(){a.ui.loadContent("#device",
!1,!0,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"));l()},function(b){a.os.android&&navigator.wificonfig.reConnectWifi();navigator.notification.confirm(b,function(){a.ui.loadContent("#device",!1,!0,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"));l()})};if(navigator.network.connection.type==Connection.WIFI)if(!0===a.molmc.device.isCreateDev())a.molmc.api.createDevice(k,e);else{var k=a.molmc.device.getEntity().Device._id,h=_.findWhere(a.molmc.device.getEntity().Tokens,{device_id:k,
isPublic:!1,clientType:"device"});e({device_id:k,access_token:h.access_token})}},k=function(b){l();a("#ios_deviceconfig .button").removeAttr("disabled");a.os.android&&navigator.wificonfig.reConnectWifi();navigator.notification.confirm(b,function(){},"\u63d0\u793a","\u786e\u5b9a")};"undefined"==typeof c||0===c.length?navigator.notification.alert("\u8bbe\u5907wifi\u4e3a\u7a7a\uff0c\u8bf7\u786e\u5b9a\u8fde\u63a5\u4e0a\u8bbe\u5907wifi",function(a){1===a&&settings.openWifiSettings(function(a){})},"\u63d0\u793a",
""):"undefined"!=typeof e&&0!==e.length||navigator.notification.alert("\u7f51\u7edcwifi\u540d\u79f0\u4e3a\u7a7a\uff0c\u8bf7\u8f93\u5165\u53ef\u4ee5\u8fde\u63a5\u4e0a\u4e92\u8054\u7f51\u7684wifi SSID",function(a){},"\u63d0\u793a","");0!==c.length&&0!==e.length&&("0"==a("#ios_btn_devconfig").val()?(a("#ios_btn_devconfig").html(_lang("device_underconfig")),a("#ios_btn_devconfig").val("1"),a("#ios_text_cannel_device").addClass("partborder fa fa-pulse"),a(".disablediv").attr("disabled","disabled"),a.molmc.utils.showToast(_lang("device_config_tip"),
280,3E3),n(d,f,k)):"1"==a("#ios_btn_devconfig").val()&&l())});var l=function(){a("#ios_btn_devconfig").html(_lang("device_config_btn"));a("#ios_btn_devconfig").val("0");a("#ios_text_cannel_device").removeClass("partborder fa fa-pulse");a(".disablediv").removeAttr("disabled");clearInterval(void 0);clearInterval(e)},n=function(b,d,k){var l=new Socket,n=0;l.onData=function(m){for(var h="",v=0;v<m.length;v++)h+=String.fromCharCode(m[v]);m=JSON.parse(h);switch(n){case 1:200===m.status&&"product_id"in m&&
"device_sn"in m?(f=m.product_id,c=m.device_sn,l.checkDeviceWifiStatus()):k("\u8bf7\u68c0\u67e5IntoRobot\u8bbe\u5907\u662f\u5426\u5904\u4e8e\u914d\u7f6e\u6a21\u5f0f");break;case 2:200===m.status&&"ssid"in m?m.ssid===b.wifissid?(l.shutdownWrite("shutdownWrite"),l.close("socket close"),d(f)):l.sendWifiInfo():l.sendWifiInfo();break;case 3:if(200===m.status){l.shutdownWrite("shutdownWrite");l.close("socket close");var t=function(c){a.ui.hideMask();clearInterval(e);c!==b.devssid?navigator.notification.confirm('wifi\u7f51\u7edc\u5df2\u6539\u53d8\uff0c\u8bf7\u8fdb\u5165"\u8bbe\u7f6e"\uff0d\u201c\u65e0\u7ebf\u5c40\u57df\u7f51\u201d\u754c\u9762\u91cd\u65b0\u9009\u62e9\u9700\u8981\u7ed1\u5b9a\u7684IntoRobot\u8bbe\u5907wifi!',
function(a){2===a?settings.openWifiSettings(function(a){window.setTimeout(p,1E3)}):k("\u5df2\u7ecf\u53d6\u6d88\u914d\u7f6e\u8bbe\u5907!")},"\u63d0\u793a",["\u53d6\u6d88","\u786e\u8ba4"]):l.open("192.168.8.1",5555,l.handDevice,function(a){p()})},u=function(a){WifiWizard.getCurrentSSID(t,u)};e=setInterval(function(){WifiWizard.getCurrentSSID(t,u)},1E3);a.ui.showMask("waitting")}else l.sendWifiInfo()}};l.handDevice=function(){for(var a=JSON.stringify({command:"hello"}),b=new Uint8Array(a.length),c=0;c<
b.length;c++)b[c]=a.charCodeAt(c);n=1;l.write(b)};l.checkDeviceWifiStatus=function(){for(var a=JSON.stringify({command:"checkWifi"}),b=new Uint8Array(a.length),c=0;c<b.length;c++)b[c]=a.charCodeAt(c);n=2;l.write(b)};l.sendWifiInfo=function(){for(var a="",a=""===b.wifipwd?JSON.stringify({command:"sendWifiInfo",value:{ssid:b.wifissid,passwd:b.wifipwd,channel:"auto",security:""}}):JSON.stringify({command:"sendWifiInfo",value:{ssid:b.wifissid,passwd:b.wifipwd,channel:"auto",security:"auto"}}),c=new Uint8Array(a.length),
d=0;d<c.length;d++)c[d]=a.charCodeAt(d);n=3;l.write(c)};var p=function(){navigator.wificonfig.isForeground(function(c){var d=function(c){a.ui.hideMask();c!==b.devssid?navigator.notification.confirm('wifi\u7f51\u7edc\u5df2\u6539\u53d8\uff0c\u8bf7\u8fdb\u5165"\u8bbe\u7f6e"\uff0d\u201c\u65e0\u7ebf\u5c40\u57df\u7f51\u201d\u754c\u9762\u91cd\u65b0\u9009\u62e9\u9700\u8981\u7ed1\u5b9a\u7684IntoRobot\u8bbe\u5907wifi!',function(a){2===a?settings.openWifiSettings(function(a){window.setTimeout(p,1E3)}):k("\u5df2\u7ecf\u53d6\u6d88\u914d\u7f6e\u8bbe\u5907!")},
"\u63d0\u793a",["\u53d6\u6d88","\u786e\u8ba4"]):l.open("192.168.8.1",5555,l.handDevice,function(a){p()})},e=function(a){WifiWizard.getCurrentSSID(d,e)};"1"===c?(WifiWizard.getCurrentSSID(d,e),a.ui.showMask("waitting")):p()},function(){window.setTimeout(p,500)})};l.open("192.168.8.1",5555,l.handDevice,function(a){k("\u8bf7\u68c0\u67e5IntoRobot\u8bbe\u5907\u662f\u5426\u5904\u4e8e\u914d\u7f6e\u6a21\u5f0f!")})},t=function(a,b,e){var k=new Socket,l=0,n=3;k.onData=function(m){for(var h="",p=0;p<m.length;p++)h+=
String.fromCharCode(m[p]);m=JSON.parse(h);switch(l){case 1:200===m.status&&"product_id"in m&&"device_sn"in m?m.product_id===f&&m.device_sn===c?k.sendDeviceInfo(a.device_id,a.access_token):e("\u8bbe\u5907\u5df2\u53d8\u66f4\uff0c\u5f02\u5e38!"):e("\u8bf7\u68c0\u67e5IntoRobot\u8bbe\u5907\u662f\u5426\u5904\u4e8e\u914d\u7f6e\u6a21\u5f0f!");break;case 2:200===m.status?(k.shutdownWrite("shutdownWrite"),k.close("setDevSocket close"),b("\u6dfb\u52a0\u8bbe\u5907"+d.devssid+"\u6210\u529f\uff01\r\u6ce8\u610f:\u60a8\u7684\u624b\u673a\u76ee\u524d\u94fe\u63a5\u7684\u662fIntoRobot\u8bbe\u5907Wi-Fi\uff0c\u82e5\u60a8\u7684IntoRbot\u8bbe\u5907\u4e0d\u80fd\u8fde\u63a5\u5230\u4e92\u8054\u7f51\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f60\u7684\u624b\u673a\u4e0d\u80fd\u4e0a\u7f51\uff0c\u8bf7\u786e\u4fdd\u60a8\u7ed9\u8bbe\u5907\u914d\u7f6e\u7684\u7f51\u7edcWi-Fi\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\u3002")):
0<n?k.sendDeviceInfo(a.device_id,a.access_token):e("\u6dfb\u52a0\u8bbe\u5907\u5931\u8d25\uff01")}};k.handDevice=function(){for(var a=JSON.stringify({command:"hello"}),b=new Uint8Array(a.length),c=0;c<b.length;c++)b[c]=a.charCodeAt(c);l=1;k.write(b)};k.sendDeviceInfo=function(a,b){n--;for(var c=JSON.stringify({command:"sendDeviceInfo",value:{device_id:a,access_token:b,cloud:"CN",zone:"8"}}),d=new Uint8Array(c.length),e=0;e<d.length;e++)d[e]=c.charCodeAt(e);l=2;k.write(d)};k.open("192.168.8.1",5555,
k.handDevice,function(a){})},p=function(){var b=(new Date).getTime().toString();a.molmc.utils.u_TimeStamp=b;var c="v1/"+a.molmc.utils.getItem("u_topic")+"/channel/userDevice/cmd/updata";a.molmc.mainMqtt.publish(c,b,0,!1)},w=function(b){var c;a.each(b,function(a){if("user"===b[a].clientType&&!1===b[a].isPublic)return c=b[a].access_token,!1});return c},z=function(b){b={userName:w(b),password:a.molmc.utils.getItem("account"),userID:a.molmc.utils.getItem("u_topic")};_.isEmpty(a.molmc.mainMqtt)?a.molmc.mainMqtt=
new a.molmc.mqtt(b):a.molmc.mainMqtt.openConnect(b)};k.prototype={};a.molmc.ios_device=new k})(af);
(function(a){var b={},f="255.255.255.255",c="",d="",e="",k,l,n,t=0,p=3,w=function(){};a("#esptouch").bind("loadpanel",function(){networkinterface.getIPAddress(function(a){f=a.substring(0,a.lastIndexOf("."))+".255"});a(".backButton").show();a.os.ios?(a("#btn_atomConfig").hide(),a("#smartConfigInfo3").html(_lang("device_smartconfig_info_ios"))):a.os.android&&(a("#btn_atomConfig").show(),a("#smartConfigInfo3").html(_lang("device_smartconfig_info")),void 0===b.wifiList?x(A,!0):A(b.wifiList));a("#smartConfig_wifissid input[name='wifiSsid']").val("");
a("#esptouch input[name='wifipwd']").val("");!0===a.molmc.device.isCreateDev()?a("#header_smartConfig_device h1").html(_lang("device_adddevice")):a("#header_smartConfig_device h1").html(_lang("device_bind"));a.molmc.utils.getLocation(function(c){if("object"==typeof c&&Object.prototype.isPrototypeOf(c)&&0!==Object.keys(c).length)b.point=c,require(["vendor/map.quick"],function(a){a.initMap("myExploreMap",{lng:c.lng,lat:c.lat,layer:5},{minZoom:4,maxZoom:16});a.LocalByPoint(c,function(a){a||(a="\u5317\u4eac\u5e02");
b.city=a})});else{var d=[_lang("g_btn_cancel"),_lang("g_btn_confirm")],e="",e=a.os.ios?_lang("g_ios_getLocationErr"):_lang("g_getLocationErr");navigator.notification.confirm(e,function(d){2===d&&a.os.ios&&settings.openLocationServicesSettings(function(b){a.ui.goBack()});c={lng:116.331398,lat:39.897445};b.point=c;require(["vendor/map.quick"],function(a){a.initMap("myExploreMap",{lng:c.lng,lat:c.lat,layer:5},{minZoom:4,maxZoom:16});a.LocalByPoint(c,function(a){a||(a="\u5317\u4eac\u5e02");b.city=a})})},
_lang("tips_title_tips"),d)}});WifiWizard.getCurrentSSID(function(b){a.ui.hideMask();c=b;a("#smartConfig_wifissid input[name='wifiSsid']").val(b)},function(b){a.ui.hideMask()});WifiWizard.getCurrentBSSID(function(a){e=a},function(a){});a.ui.showMask("waitting")});a("#esptouch").bind("unloadpanel",function(){y()});a("#btn_atomConfig").bind("tap",function(){a.os.ios||a.os.android&&z()});a("#esptouch").on("tap","#btn_smartConfig",function(){var b;a.os.ios?b=a("#smartConfig_wifissid input[name='wifiSsid']").val():
a.os.android&&(b=a("#smartConfig_wifissid select[name='wifiSsid']").val());var f=a("#esptouch input[name='wifipwd']").val();c=b;d=f;"undefined"!=typeof b&&0!==b.length||navigator.notification.alert(_lang("tips_wifiname_empty"),function(a){},_lang("tips_title_tips"),"");0!==b.length&&("0"==a("#btn_smartConfig").val()?(a("#btn_smartConfig").html(_lang("device_underconfig")),a("#btn_smartConfig").val("1"),a("#text_cannel_smartConfig").addClass("partborder fa fa-pulse"),a(".disablediv").attr("disabled",
"disabled"),esptouchPlugin.smartConfig(c,e,d,"no","1",function(){a.molmc.utils.showToast(_lang("tips_smartconfig_success"),280,3E3);E()},function(){y();a.molmc.utils.showToast(_lang("tips_smartconfig_error"),280,3E3)})):"1"==a("#btn_smartConfig").val()&&y())});var z=function(){var b="",b='<div style="font-size:17px;bottom-border:1px solid;"><span class="fa fa-refresh padding5 width100" id="pop_config_scan"> '+_lang("device_wifi_scan")+"</span></div>",b=b+'<div style="font-size:17px"><span class="fa fa-cogs padding5 width100" id="pop_goto_oldconfig"> '+
_lang("config_old")+"</span></div>",c=a.ui.popup({id:"popup_gotooldconfig",title:"Alert! Alert!",message:b,cancelText:"Cancel me",cancelCallback:function(){},doneText:"I'm done!",doneCallback:function(){},cancelOnly:!1,hideFooter:!0,tapHide:!0,suppressTitle:!0,posOffset:50});a("#popup_gotooldconfig").css({left:"auto",top:"45px",width:"auto",right:"0",padding:"0","border-radius":"0"});a("#popup_gotooldconfig #pop_config_scan").bind("tap",function(){c.hide();x(A,!0)});a("#popup_gotooldconfig #pop_goto_oldconfig").bind("tap",
function(){c.hide();a.ui.loadContent("#deviceconfig",!1,!1,"slide")})},x=function(c,d){navigator.wificonfig.getSsidList(function(d){b.wifiList=d;c(d);a.ui.hideMask()},function(b){a.ui.hideMask()});!0===d&&a.ui.showMask(_lang("device_wifi_scanning"))},A=function(b){a.ui.hideMask();if(void 0!==b){a("#smartConfig_wifissid").empty();for(var c="",d=0;d<b.length;d++)c=c+'<option value="'+b[d]+'">'+b[d]+"</option>";c='<select name="wifiSsid" class="disablediv">'+c+"</select>";a("#smartConfig_wifissid").append(c)}},
y=function(){a("#btn_smartConfig").html(_lang("device_config_btn"));a("#btn_smartConfig").val("0");a("#text_cannel_smartConfig").removeClass("partborder fa fa-pulse");a(".disablediv").removeAttr("disabled");esptouchPlugin.cancelConfig(function(a){},function(a){});clearInterval(k);clearInterval(l);v();t=0;p=3},B=function(c){null==a.molmc.utils.getItem("count")&&a.molmc.utils.setItem("count",1);var d=a.molmc.utils.getItem("count");c={uid:a.molmc.utils.getItem("uid"),name:c.device_sn+"_"+d,isPublic:!0,
tags:"neutron",dev_img:"assets/img/intodunio.png",shareType:1,product_id:c.product_id,city:b.city,coordinate:[b.point.lng,b.point.lat],description:c.device_sn+"_"+d};p=3;navigator.network.connection.type==Connection.WIFI&&(!0===a.molmc.device.isCreateDev()?a.molmc.api.createDevice(c,m):(c=a.molmc.device.getEntity().Device._id,d=_.findWhere(a.molmc.device.getEntity().Tokens,{device_id:c,isPublic:!1,clientType:"device"}),m({device_id:c,access_token:d.access_token})))},E=function(){chrome.sockets.udp.create(function(a){n=
a.socketId;chrome.sockets.udp.bind(n,"0.0.0.0",5557,function(a){0<=a&&(chrome.sockets.udp.onReceive.addListener(h),chrome.sockets.udp.onReceiveError.addListener(C),F())})})},F=function(){var b=0;k=setInterval(function(){b++;100<b&&(clearInterval(k),y(),a.molmc.utils.showToast(_lang("tips_smartconfig_hand_err"),280,3E3));var c=JSON.stringify({command:"hello"}),c=u(c);chrome.sockets.udp.send(n,c,f,5556,function(a){})},3E3);t=1;p--},m=function(b){var c=0;l=setInterval(function(){c++;10<c&&(clearInterval(l),
y(),a.molmc.utils.showToast(_lang("tips_smartconfig_failed"),280,3E3));var d=JSON.stringify({command:"sendDeviceInfo",value:{cloud:"CN",zone:8,access_token:b.access_token,device_id:b.device_id}}),d=u(d);chrome.sockets.udp.send(n,d,f,5556,function(a){})},5E3);t=2;p--},h=function(c){var d=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(c.data))),e=d.device_sn,f=function(c){a.molmc.mainMqtt.disconnect();a.molmc.device.openMainMqtt(b.Tokens);a.molmc.device.publishDevInfoNew();a.molmc.device.updataDevAndToken();
a.ui.hideMask();var d=parseInt(d)+1;a.molmc.utils.setItem("count",d);!0!==a.molmc.device.isCreateDev()&&(c=_lang("device_bind")+_lang("g_success"));navigator.notification.confirm(c,function(){a.ui.loadContent("#device",!1,!0,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"));y()},h=function(b){y();a("#esptouch .button").removeAttr("disabled");navigator.notification.confirm(b,function(){a.ui.loadContent("#device",!1,!0,"slide")},_lang("tips_title_tips"),_lang("g_tips_confirm"))};switch(t){case 1:c.socketId===
n&&(200===d.status&&"product_id"in d&&"device_sn"in d?(clearInterval(k),B(d)):0<p?F():h(_lang("tcp_first_create_failed")));break;case 2:c.socketId===n&&(200===d.status?(clearInterval(l),v(),f(_lang("device_create")+e+_lang("g_success"))):0<p?m():h(_lang("tips_smartconfig_create_failed")))}},v=function(){chrome.sockets.udp.close(n,function(){})},C=function(a){},u=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return b};w.prototype={};
a.molmc.smartconfig=new w})(af);
